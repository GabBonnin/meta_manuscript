<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
    <meta charset="utf-8">
    <meta name="generator" content="quarto-1.8.26">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

    <meta name="author" content="Gabriel Bonnin">

    <title>META preprocessing</title>
    <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      div.columns{display: flex; gap: min(4vw, 1.5em);}
      div.column{flex: auto; overflow-x: auto;}
      div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
      ul.task-list{list-style: none;}
      ul.task-list li input[type="checkbox"] {
        width: 0.8em;
        margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
        vertical-align: middle;
      }
      /* CSS for syntax highlighting */
      html { -webkit-text-size-adjust: 100%; }
      pre > code.sourceCode { white-space: pre; position: relative; }
      pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
      pre > code.sourceCode > span:empty { height: 1.2em; }
      .sourceCode { overflow: visible; }
      code.sourceCode > span { color: inherit; text-decoration: inherit; }
      div.sourceCode { margin: 1em 0; }
      pre.sourceCode { margin: 0; }
      @media screen {
      div.sourceCode { overflow: auto; }
      }
      @media print {
      pre > code.sourceCode { white-space: pre-wrap; }
      pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
      }
      pre.numberSource code
        { counter-reset: source-line 0; }
      pre.numberSource code > span
        { position: relative; left: -4em; counter-increment: source-line; }
      pre.numberSource code > span > a:first-child::before
        { content: counter(source-line);
          position: relative; left: -1em; text-align: right; vertical-align: baseline;
          border: none; display: inline-block;
          -webkit-touch-callout: none; -webkit-user-select: none;
          -khtml-user-select: none; -moz-user-select: none;
          -ms-user-select: none; user-select: none;
          padding: 0 4px; width: 4em;
        }
      pre.numberSource { margin-left: 3em;  padding-left: 4px; }
      div.sourceCode
        {   }
      @media screen {
      pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
      }
    </style>

    <style>
      body.hypothesis-enabled #quarto-embed-header {
        padding-right: 36px;
      }

      #quarto-embed-header {
        height: 3em;
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: solid 1px;
      }

      #quarto-embed-header h6 {
        font-size: 1.1em;
        padding-top: 0.6em;
        margin-left: 1em;
        margin-right: 1em;
        font-weight: 400;
      }

      #quarto-embed-header a.quarto-back-link,
      #quarto-embed-header a.quarto-download-embed {
        font-size: 0.8em;
        margin-top: 1em;
        margin-bottom: 1em;
        margin-left: 1em;
        margin-right: 1em;
      }

      .quarto-back-container {
        padding-left: 0.5em;
        display: flex;
      }

      .headroom {
          will-change: transform;
          transition: transform 200ms linear;
      }

      .headroom--pinned {
          transform: translateY(0%);
      }

      .headroom--unpinned {
          transform: translateY(-100%);
      }      
    </style>

    <script>
    window.document.addEventListener("DOMContentLoaded", function () {

      var header = window.document.querySelector("#quarto-embed-header");
      const titleBannerEl = window.document.querySelector("body > #title-block-header");
      if (titleBannerEl) {
        titleBannerEl.style.paddingTop = header.clientHeight + "px";
      }
      const contentEl = window.document.getElementById('quarto-content');
      for (const child of contentEl.children) {
        child.style.paddingTop = header.clientHeight + "px";
        child.style.marginTop = "1em";
      }

      // Use the article root if the `back` call doesn't work. This isn't perfect
      // but should typically work
      window.quartoBackToArticle = () => {
        var currentUrl = window.location.href;
        window.history.back();
        setTimeout(() => {
            // if location was not changed in 100 ms, then there is no history back
            if(currentUrl === window.location.href){              
                // redirect to site root
                window.location.href = "../../index.html";
            }
        }, 100);
      }

      const headroom = new window.Headroom(header, {
        tolerance: 5,
        onPin: function () {
        },
        onUnpin: function () {
        },
      });
      headroom.init();
    });
    </script>

    
<script src="../../site_libs/manuscript-notebook/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-a74871fe4945b66d259aafc266475145.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
     
      </head>

  <body class="quarto-notebook quarto-light">
    <div id="quarto-embed-header" class="headroom fixed-top bg-primary">
      
      <a onclick="window.quartoBackToArticle(); return false;" class="btn btn-primary quarto-back-link" href=""><i class="bi bi-caret-left"></i> Back to Article</a>
      <h6><i class="bi bi-journal-code"></i> META preprocessing</h6>

            <a href="../../scripts/2_meta_adult_preprocessing/meta_adult_preprocessing.qmd" class="btn btn-primary quarto-download-embed" download="meta_adult_preprocessing.qmd">Download Source</a>
          </div>

     <header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">META preprocessing</h1>
          </div>

    
    <div class="quarto-title-meta-container">
      <div class="quarto-title-meta-column-start">
        
        <div class="quarto-title-meta">

                <div>
            <div class="quarto-title-meta-heading">Author</div>
            <div class="quarto-title-meta-contents">
                        <p>Gabriel Bonnin </p>
                      </div>
          </div>
                
          
                
              </div>
      </div>
      <div class="quarto-title-meta-column-end quarto-other-formats-target">
      </div>
    </div>



    <div class="quarto-other-links-text-target">
    </div>  </div>
</header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#preprocessing" id="toc-preprocessing" class="nav-link active" data-scroll-target="#preprocessing">Preprocessing</a>
  <ul class="collapse">
  <li><a href="#prepare-self-report-rating-scales-from-the-outpatient-clinic" id="toc-prepare-self-report-rating-scales-from-the-outpatient-clinic" class="nav-link" data-scroll-target="#prepare-self-report-rating-scales-from-the-outpatient-clinic">prepare self-report rating scales from the outpatient clinic</a>
  <ul class="collapse">
  <li><a href="#demographics-and-context-factors" id="toc-demographics-and-context-factors" class="nav-link" data-scroll-target="#demographics-and-context-factors">Demographics and context factors</a></li>
  <li><a href="#cgi-improvement-scale" id="toc-cgi-improvement-scale" class="nav-link" data-scroll-target="#cgi-improvement-scale">CGI Improvement Scale</a></li>
  <li><a href="#diagnosis" id="toc-diagnosis" class="nav-link" data-scroll-target="#diagnosis">Diagnosis</a></li>
  <li><a href="#bdi-ii" id="toc-bdi-ii" class="nav-link" data-scroll-target="#bdi-ii">BDI II</a></li>
  <li><a href="#bsi" id="toc-bsi" class="nav-link" data-scroll-target="#bsi">BSI</a></li>
  <li><a href="#dass-42" id="toc-dass-42" class="nav-link" data-scroll-target="#dass-42">DASS-42</a></li>
  <li><a href="#gas" id="toc-gas" class="nav-link" data-scroll-target="#gas">GAS</a></li>
  <li><a href="#pmh" id="toc-pmh" class="nav-link" data-scroll-target="#pmh">PMH</a></li>
  <li><a href="#global-improvement" id="toc-global-improvement" class="nav-link" data-scroll-target="#global-improvement">Global Improvement</a></li>
  </ul></li>
  <li><a href="#plausibility-checks-of-assessment-time-points" id="toc-plausibility-checks-of-assessment-time-points" class="nav-link" data-scroll-target="#plausibility-checks-of-assessment-time-points">Plausibility Checks of Assessment Time Points</a></li>
  <li><a href="#prepare-text-data" id="toc-prepare-text-data" class="nav-link" data-scroll-target="#prepare-text-data">prepare text data</a></li>
  <li><a href="#merge-text-and-self-rating-scales" id="toc-merge-text-and-self-rating-scales" class="nav-link" data-scroll-target="#merge-text-and-self-rating-scales">merge text and self-rating scales</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">      

       <section id="preprocessing" class="level1">
<h1>Preprocessing</h1>
<section id="prepare-self-report-rating-scales-from-the-outpatient-clinic" class="level2">
<h2 class="anchored" data-anchor-id="prepare-self-report-rating-scales-from-the-outpatient-clinic">prepare self-report rating scales from the outpatient clinic</h2>
<div class="cell-container"><div class="cell-decorator"><pre>In [1]:</pre></div><div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.1     ✔ stringr   1.5.1
✔ ggplot2   3.5.2     ✔ tibble    3.3.0
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.1.0     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
</div></div>
<section id="demographics-and-context-factors" class="level3">
<h3 class="anchored" data-anchor-id="demographics-and-context-factors">Demographics and context factors</h3>
<div class="cell-container"><div class="cell-decorator"><pre>In [2]:</pre></div><div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>patient_kodap <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"/Volumes/meta_data/raw/raw_selfreport/Patient_KODAP_ab2017.xlsx"</span>,</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">"case_nr"</span>, <span class="st">"patient_chiffre"</span>,<span class="st">"patient_sex"</span>,<span class="st">"patient_dateofbirth"</span>,<span class="st">"assessment_date"</span>,<span class="st">"assessment_type"</span>,<span class="st">"assessment_id"</span>,<span class="st">"assessment_name"</span>,<span class="st">"item_no"</span>,<span class="st">"answerscale_value"</span>,<span class="st">"freecomment"</span>,<span class="st">"therapist_no"</span>,<span class="st">"therapist_sex"</span>,<span class="st">"therapist_dateofbirth"</span>),</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">skip =</span> <span class="dv">1</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>therapist_kodap <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"/Volumes/meta_data/raw/raw_selfreport/Therapeuten_KODAP_ab2017.xlsx"</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">"case_nr"</span>, <span class="st">"patient_chiffre"</span>,<span class="st">"patient_sex"</span>,<span class="st">"patient_dateofbirth"</span>,<span class="st">"assessment_date"</span>,<span class="st">"assessment_type"</span>,<span class="st">"assessment_id"</span>,<span class="st">"assessment_name"</span>,<span class="st">"item_no"</span>,<span class="st">"answerscale_value"</span>,<span class="st">"freecomment"</span>,<span class="st">"therapist_no"</span>,<span class="st">"therapist_sex"</span>,<span class="st">"therapist_dateofbirth"</span>),</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">skip =</span> <span class="dv">1</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># show different assessment names (e.g. pre and post assesments)</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(patient_kodap<span class="sc">$</span>assessment_name)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Patientenfragebogen KODAP_Post" "Patientenfragebogen KODAP_Pre" </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># show different assessment types (e.g. standardised assessment time points)</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(patient_kodap<span class="sc">$</span>assessment_type)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "LZT1-DUPost"                                 
 [2] "DU-Kat6"                                     
 [3] "DU-Kat12"                                    
 [4] "Diagnostisches Interview ab 01.04.2017"      
 [5] "KZT1-DUPost"                                 
 [6] "KZT2-DUPost"                                 
 [7] "DU-Kat24"                                    
 [8] "KiJu_Du_prä"                                 
 [9] "LZT2-DUPost"                                 
[10] "Du-Kat6 ohne Abrechnung"                     
[11] "Du-Kat24 ohne Abrechnung"                    
[12] "DU-Prä"                                      
[13] "LZT-DU40"                                    
[14] "Du-Kat12 ohne Abrechnung"                    
[15] "Du-Post(außerplanmäßig)"                     
[16] "KiJu-Kat24"                                  
[17] "Sprechstunde2"                               
[18] "KiJu-Kat6"                                   
[19] "Diagnostisches Interview ab 01.04.2017-Video"
[20] "KiJu-Kat6-ohne Abrechnung"                   
[21] "Du-Post-KZT1"                                
[22] "KiJu-Kat12"                                  
[23] "Minidips-Kat24"                              
[24] "KiJu-KZT2-DuPost"                            
[25] "Minidips-Kat12"                              
[26] "KiJu-LZT1-DuPost"                            
[27] "Erstgespräch (probatorisch)"                 
[28] "Sprechstunde3"                               </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#how many patients are there for each assessment type?</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>patient_kodap <span class="sc">|&gt;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_patienten =</span> <span class="fu">n_distinct</span>(case_nr),</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> assessment_type</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n_patienten))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 28 × 2
   assessment_type                        n_patienten
   &lt;chr&gt;                                        &lt;int&gt;
 1 KZT1-DUPost                                   1883
 2 Diagnostisches Interview ab 01.04.2017        1756
 3 KZT2-DUPost                                   1478
 4 DU-Kat6                                        840
 5 LZT1-DUPost                                    756
 6 DU-Kat12                                       682
 7 DU-Kat24                                       555
 8 LZT2-DUPost                                    203
 9 Du-Kat24 ohne Abrechnung                       145
10 KiJu-Kat24                                     137
# ℹ 18 more rows</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#remove non-relevant assessment types (e.g.from children and adolesent database, group sessions, assessment types with very little cases) and assessment names (e.g. kodap post)</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>patient_kodap_pre_demographics <span class="ot">&lt;-</span> patient_kodap <span class="sc">|&gt;</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(assessment_name <span class="sc">==</span> <span class="st">"Patientenfragebogen KODAP_Pre"</span> <span class="sc">&amp;</span> assessment_type <span class="sc">==</span> <span class="st">"Diagnostisches Interview ab 01.04.2017"</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># pivot wider</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>patient_kodap_pre_demographics_wider <span class="ot">&lt;-</span> patient_kodap_pre_demographics <span class="sc">|&gt;</span> </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(item_no <span class="sc">!=</span> <span class="dv">1</span> <span class="sc">&amp;</span> item_no<span class="sc">!=</span> <span class="dv">2</span>) <span class="sc">|&gt;</span>  <span class="co">#remove irrelevant items (1 = date of birth, 2 = sex)</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> case_nr, <span class="at">names_from =</span> item_no, <span class="at">values_from =</span> answerscale_value) <span class="sc">|&gt;</span> <span class="co"># remove patient_chiffre and other redundant variables (date of birth, sex, etc.) for merging with other self-rating df's </span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">marital_status =</span> <span class="st">"3"</span>, <span class="at">in_relationship =</span> <span class="st">"4"</span>, <span class="at">general_education =</span> <span class="st">"5"</span>, <span class="at">vocational_qualification =</span> <span class="st">"6"</span>, <span class="at">work_ability_status =</span> <span class="st">"7"</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co"># transform to factors with labels</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co"># set labels</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>marital_status_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"0"</span> <span class="ot">=</span> <span class="st">"single"</span>, <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"married"</span>, <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"divorced"</span>, <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"seperated"</span>, <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"widowed"</span>, <span class="st">"5"</span> <span class="ot">=</span> <span class="st">"other"</span>)</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>relationship_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"0"</span> <span class="ot">=</span> <span class="st">"yes"</span>, <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"no"</span>)</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>general_education_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"0"</span> <span class="ot">=</span> <span class="st">"student"</span>, <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"no school-leaving certificate"</span>, <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"lower secondary school certificate"</span>, <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"intermediate secondary school certificate"</span>, <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"higher education entrance qualification"</span>, <span class="st">"5"</span> <span class="ot">=</span> <span class="st">"other"</span>) </span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>vocational_qualification_labels  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"0"</span> <span class="ot">=</span> <span class="st">"Currently in vocational training or studying"</span>, <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"No vocational qualification"</span>, <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"Apprenticeship / vocational training"</span>, <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"University or university of applied sciences degree"</span>, <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"Other"</span>) </span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>work_ability_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"0"</span> <span class="ot">=</span> <span class="st">"Able to work"</span>, <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"Unable to work (on sick leave)"</span>, <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"Disability pension"</span>, <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"Old-age pension"</span>, <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"Other"</span>) </span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="co"># transform to factor and add labels</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>patient_kodap_pre_demographics_wider<span class="sc">$</span>marital_status <span class="ot">&lt;-</span> <span class="fu">factor</span>(patient_kodap_pre_demographics_wider<span class="sc">$</span>marital_status, <span class="at">levels =</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(marital_status_labels)), <span class="at">labels =</span> marital_status_labels)</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>patient_kodap_pre_demographics_wider<span class="sc">$</span>in_relationship <span class="ot">&lt;-</span> <span class="fu">factor</span>(patient_kodap_pre_demographics_wider<span class="sc">$</span>in_relationship, <span class="at">levels =</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(relationship_labels)), <span class="at">labels =</span> relationship_labels)</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>patient_kodap_pre_demographics_wider<span class="sc">$</span>general_education <span class="ot">&lt;-</span> <span class="fu">factor</span>(patient_kodap_pre_demographics_wider<span class="sc">$</span>general_education, <span class="at">levels =</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(general_education_labels)), <span class="at">labels =</span> general_education_labels)</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>patient_kodap_pre_demographics_wider<span class="sc">$</span>vocational_qualification <span class="ot">&lt;-</span> <span class="fu">factor</span>(patient_kodap_pre_demographics_wider<span class="sc">$</span>vocational_qualification, <span class="at">levels =</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(vocational_qualification_labels)), <span class="at">labels =</span> vocational_qualification_labels)</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>patient_kodap_pre_demographics_wider<span class="sc">$</span>work_ability_status <span class="ot">&lt;-</span> <span class="fu">factor</span>(patient_kodap_pre_demographics_wider<span class="sc">$</span>work_ability_status, <span class="at">levels =</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(work_ability_labels)), <span class="at">labels =</span> work_ability_labels)</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a><span class="co"># show different assessment names (e.g. pre and post assesments)</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(therapist_kodap<span class="sc">$</span>assessment_name)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Therapeutenfragebogen KODAP_Pre"  "Therapeutenfragebogen_KODAP_Post"
[3] "Therapeutenfragebogen_KODAP_Kat" </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># show different assessment types (e.g. standardised assessment time points)</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(therapist_kodap<span class="sc">$</span>assessment_type)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Diagnostisches Interview ab 01.04.2017"      
 [2] "KZT1-DUPost"                                 
 [3] "KZT2-DUPost"                                 
 [4] "Minidips-Kat6"                               
 [5] "LZT1-DUPost"                                 
 [6] "Diagnostisches Interview"                    
 [7] "Minidips-Kat6-Video"                         
 [8] "Minidips-Kat24-Video"                        
 [9] "Minidips-Kat12"                              
[10] "Minidips-Kat12-Video"                        
[11] "Minidips-Kat24"                              
[12] "Minidips-Kat24-telefonisch"                  
[13] "DU-Prä"                                      
[14] "Minidips-Kat12-telefonisch"                  
[15] "LZT2-DUPost"                                 
[16] "Du-Post(außerplanmäßig)"                     
[17] "Diagnostisches Interview ab 01.04.2017-Video"
[18] "Sprechstunde2"                               
[19] "Minidips-Kat6-telefonisch"                   
[20] "Probatorische Einzeltherapiesitzung-Video"   
[21] "Persönlicher Kurzkontakt-Video"              
[22] "Sprechstunde-Video"                          
[23] "Persönlicher Kurzkontakt"                    
[24] "Du-Post-KZT1"                                
[25] "KiJu-LZT1-DuPost"                            
[26] "Erstgespräch (probatorisch)"                 
[27] "Sprechstunde3"                               
[28] "probatorische Einzeltherapiesitzung"         </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#how many patients are there for each assessment type?</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>therapist_kodap <span class="sc">|&gt;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_patienten =</span> <span class="fu">n_distinct</span>(case_nr),</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> assessment_type</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n_patienten))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 28 × 2
   assessment_type                        n_patienten
   &lt;chr&gt;                                        &lt;int&gt;
 1 Diagnostisches Interview ab 01.04.2017        2735
 2 KZT1-DUPost                                   1552
 3 KZT2-DUPost                                   1112
 4 LZT1-DUPost                                    535
 5 Minidips-Kat6                                  151
 6 Minidips-Kat12                                 138
 7 LZT2-DUPost                                    130
 8 Minidips-Kat24                                 110
 9 DU-Prä                                          86
10 Minidips-Kat24-Video                            48
# ℹ 18 more rows</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#remove non-relevant assessment types (e.g.from children and adolesent database, group sessions, assessment types with very little cases) and assessment names (e.g. kodap post)</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>therapist_kodap_pre_context <span class="ot">&lt;-</span> therapist_kodap <span class="sc">|&gt;</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(assessment_name <span class="sc">==</span> <span class="st">"Therapeutenfragebogen KODAP_Pre"</span> <span class="sc">&amp;</span> assessment_type <span class="sc">==</span> <span class="st">"Diagnostisches Interview ab 01.04.2017"</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># pivot wider</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>therapist_kodap_pre_context_wider <span class="ot">&lt;-</span> therapist_kodap_pre_context <span class="sc">|&gt;</span> </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(item_no <span class="sc">==</span> <span class="dv">5</span> <span class="sc">|</span> item_no <span class="sc">==</span> <span class="dv">6</span> <span class="sc">|</span> item_no <span class="sc">==</span> <span class="dv">7</span> <span class="sc">|</span> item_no <span class="sc">==</span> <span class="dv">8</span>) <span class="sc">|&gt;</span>  <span class="co">#filter relevant items</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(case_nr), <span class="at">names_from =</span> item_no, <span class="at">values_from =</span> <span class="fu">c</span>(answerscale_value, freecomment)) <span class="sc">|&gt;</span>  <span class="co">#remove patient_chiffre and other redundant variables (date of birth, sex, etc.) for merging with other self-rating df's </span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(case_nr, answerscale_value_5, answerscale_value_8, freecomment_6) <span class="sc">|&gt;</span> <span class="co">#remove irrelevant variables</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">previous_psychotherapy =</span> <span class="st">"answerscale_value_5"</span>, <span class="at">icd10_code =</span> <span class="st">"freecomment_6"</span>, <span class="at">CGI_severity =</span> <span class="st">"answerscale_value_8"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Values from `answerscale_value` and `freecomment` are not uniquely identified;
output will contain list-cols.
• Use `values_fn = list` to suppress this warning.
• Use `values_fn = {summary_fun}` to summarise duplicates.
• Use the following dplyr code to identify duplicates.
  {data} |&gt;
  dplyr::summarise(n = dplyr::n(), .by = c(case_nr, item_no)) |&gt;
  dplyr::filter(n &gt; 1L)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># transform to factors with labels</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>previous_psychotherapy_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"0"</span> <span class="ot">=</span> <span class="st">"no prior treatment"</span>, <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"outpatient psychotherapy"</span>, <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"inpatient psychotherapy"</span>, <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"both"</span>, <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"exact specification not available"</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>CGI_severity_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"0"</span> <span class="ot">=</span> <span class="st">"Not assessable"</span>, <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"Normal, not at all ill"</span>, <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"Borderline mentally ill"</span>, <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"Mildly ill"</span>, <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"Moderately ill"</span>, <span class="st">"5"</span> <span class="ot">=</span> <span class="st">"Markedly ill"</span>, <span class="st">"6"</span> <span class="ot">=</span> <span class="st">"Severely ill"</span>, <span class="st">"7"</span> <span class="ot">=</span> <span class="st">"Among the most extremely ill patients"</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>therapist_kodap_pre_context_wider<span class="sc">$</span>previous_psychotherapy <span class="ot">&lt;-</span> <span class="fu">factor</span>(therapist_kodap_pre_context_wider<span class="sc">$</span>previous_psychotherapy, <span class="at">levels =</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(previous_psychotherapy_labels)), <span class="at">labels =</span> previous_psychotherapy_labels)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>therapist_kodap_pre_context_wider<span class="sc">$</span>CGI_severity <span class="ot">&lt;-</span> <span class="fu">factor</span>(therapist_kodap_pre_context_wider<span class="sc">$</span>CGI_severity, <span class="at">levels =</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(CGI_severity_labels)), <span class="at">labels =</span> CGI_severity_labels)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div></div>
</section>
<section id="cgi-improvement-scale" class="level3">
<h3 class="anchored" data-anchor-id="cgi-improvement-scale">CGI Improvement Scale</h3>
<div class="cell-container"><div class="cell-decorator"><pre>In [3]:</pre></div><div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#remove non-relevant assessment types (e.g.from children and adolesent database, group sessions, assessment types with very little cases) and assessment names (e.g. kodap pre)</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>patient_kodap_post <span class="ot">&lt;-</span> patient_kodap <span class="sc">|&gt;</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(assessment_name <span class="sc">==</span> <span class="st">"Patientenfragebogen KODAP_Post"</span> <span class="sc">&amp;</span> (assessment_type <span class="sc">==</span> <span class="st">"KZT1-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"KZT2-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"LZT1-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"LZT2-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"DU-Kat6"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"DU-Kat12"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"DU-Kat24"</span>))</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># pivot wider</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>patient_cgi_improvement_wider <span class="ot">&lt;-</span> patient_kodap_post <span class="sc">|&gt;</span> </span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(item_no <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">|&gt;</span>  <span class="co">#filter relevant items</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> case_nr, <span class="at">names_from =</span> <span class="fu">c</span>(item_no, assessment_type), <span class="at">values_from =</span> answerscale_value) <span class="sc">|&gt;</span> </span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"cgi_improvement_patient_KZT1-DUPost"</span> <span class="ot">=</span> <span class="st">"2_KZT1-DUPost"</span>, <span class="st">"cgi_improvement_patient_KZT2-DUPost"</span> <span class="ot">=</span> <span class="st">"2_KZT2-DUPost"</span>, <span class="st">"cgi_improvement_patient_LZT1-DUPost"</span> <span class="ot">=</span> <span class="st">"2_LZT1-DUPost"</span>, <span class="st">"cgi_improvement_patient_LZT2-DUPost"</span> <span class="ot">=</span> <span class="st">"2_LZT2-DUPost"</span>, <span class="st">"cgi_improvement_patient_DU-Kat6"</span> <span class="ot">=</span> <span class="st">"2_DU-Kat6"</span>, <span class="st">"cgi_improvement_patient_DU-Kat12"</span> <span class="ot">=</span> <span class="st">"2_DU-Kat12"</span>, <span class="st">"cgi_improvement_patient_DU-Kat24"</span> <span class="ot">=</span> <span class="st">"2_DU-Kat24"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(case_nr, <span class="st">"cgi_improvement_patient_KZT1-DUPost"</span>, <span class="st">"cgi_improvement_patient_KZT2-DUPost"</span>, <span class="st">"cgi_improvement_patient_LZT1-DUPost"</span>, <span class="st">"cgi_improvement_patient_LZT2-DUPost"</span>, <span class="st">"cgi_improvement_patient_DU-Kat6"</span>, <span class="st">"cgi_improvement_patient_DU-Kat12"</span>, <span class="st">"cgi_improvement_patient_DU-Kat24"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Values from `answerscale_value` are not uniquely identified; output will
contain list-cols.
• Use `values_fn = list` to suppress this warning.
• Use `values_fn = {summary_fun}` to summarise duplicates.
• Use the following dplyr code to identify duplicates.
  {data} |&gt;
  dplyr::summarise(n = dplyr::n(), .by = c(case_nr, item_no, assessment_type))
  |&gt;
  dplyr::filter(n &gt; 1L)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>therapist_kodap_post <span class="ot">&lt;-</span> therapist_kodap <span class="sc">|&gt;</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(assessment_name <span class="sc">==</span> <span class="st">"Therapeutenfragebogen_KODAP_Post"</span> <span class="sc">&amp;</span> (assessment_type <span class="sc">==</span> <span class="st">"KZT1-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"KZT2-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"LZT1-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"LZT2-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"Minidips-Kat6"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"Minidips-Kat12"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"Minidips-Kat24"</span>)) </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Therapeuten CGI Improvement macht in der Kat keinen Sinn, da hier i.d.R. andere Therapeuten das Rating vornehmen und damit keine relative Einschätzung der "Besserung" vorgenommen werden kann --&gt; Kats für CGI Improvement Therapeutenrating ausschließen</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co"># pivot wider</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>therapist_cgi_improvement_wider <span class="ot">&lt;-</span> therapist_kodap_post <span class="sc">|&gt;</span> </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(item_no <span class="sc">==</span> <span class="dv">14</span>) <span class="sc">|&gt;</span>  <span class="co">#filter relevant items</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> case_nr, <span class="at">names_from =</span> <span class="fu">c</span>(item_no, assessment_type), <span class="at">values_from =</span> answerscale_value)  <span class="sc">|&gt;</span> </span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"cgi_improvement_therapist_KZT1-DUPost"</span> <span class="ot">=</span> <span class="st">"14_KZT1-DUPost"</span>, <span class="st">"cgi_improvement_therapist_KZT2-DUPost"</span> <span class="ot">=</span> <span class="st">"14_KZT2-DUPost"</span>, <span class="st">"cgi_improvement_therapist_LZT1-DUPost"</span> <span class="ot">=</span> <span class="st">"14_LZT1-DUPost"</span>, <span class="st">"cgi_improvement_therapist_LZT2-DUPost"</span> <span class="ot">=</span> <span class="st">"14_LZT2-DUPost"</span>, <span class="st">"cgi_improvement_therapist_DU-Kat6"</span> <span class="ot">=</span> <span class="st">"14_Minidips-Kat6"</span>, <span class="st">"cgi_improvement_therapist_DU-Kat12"</span> <span class="ot">=</span> <span class="st">"14_Minidips-Kat12"</span>, <span class="st">"cgi_improvement_therapist_DU-Kat24"</span> <span class="ot">=</span> <span class="st">"14_Minidips-Kat24"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(case_nr, <span class="st">"cgi_improvement_therapist_KZT1-DUPost"</span>, <span class="st">"cgi_improvement_therapist_KZT2-DUPost"</span>, <span class="st">"cgi_improvement_therapist_LZT1-DUPost"</span>, <span class="st">"cgi_improvement_therapist_LZT2-DUPost"</span>, <span class="st">"cgi_improvement_therapist_DU-Kat6"</span>, <span class="st">"cgi_improvement_therapist_DU-Kat12"</span>, <span class="st">"cgi_improvement_therapist_DU-Kat24"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div></div>
</section>
<section id="diagnosis" class="level3">
<h3 class="anchored" data-anchor-id="diagnosis">Diagnosis</h3>
<div class="cell-container"><div class="cell-decorator"><pre>In [4]:</pre></div><div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>dsmv_master <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"/Volumes/meta_data/raw/raw_selfreport/DSM_V_ab2017.xlsx"</span>,</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">"case_nr"</span>, <span class="st">"patient_chiffre"</span>,<span class="st">"patient_sex"</span>,<span class="st">"patient_dateofbirth"</span>,<span class="st">"assessment_date"</span>,<span class="st">"assessment_type"</span>,<span class="st">"assessment_id"</span>,<span class="st">"assessment_name"</span>,<span class="st">"item_no"</span>,<span class="st">"treenodepath"</span>,<span class="st">"answerscale_value"</span>,<span class="st">"therapist_no"</span>,<span class="st">"therapist_sex"</span>,<span class="st">"therapist_dateofbirth"</span>),</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">skip =</span> <span class="dv">1</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co"># this table codes the answescale_value of item_no 5 to a dsm-v diagnosis</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>dsmv_codebook <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"/Volumes/meta_data/raw/raw_selfreport/DSMV_Diagno_inhalt_Code.xlsx"</span>,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>                           <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">"scalevalue"</span>,<span class="st">"dsmv_diagnosis"</span>,<span class="st">"assessment_id"</span>),</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>                           <span class="at">skip =</span> <span class="dv">1</span>)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="co">#how many patients are there for each assessment type?</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>dsmv_master <span class="sc">|&gt;</span> </span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_patients =</span> <span class="fu">n_distinct</span>(case_nr),</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> assessment_type</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n_patients))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 102 × 2
   assessment_type                        n_patients
   &lt;chr&gt;                                       &lt;int&gt;
 1 Sprechstunde1                                8206
 2 KiJu-Sprechstunde1                           3496
 3 Diagnostisches Interview ab 01.04.2017       3173
 4 KZT1-DUPost                                  1744
 5 Eltern-DIPS(Eltern)                          1532
 6 KZT1-DU4                                     1279
 7 KZT2-DUPost                                  1233
 8 KiJu-Sprechstd.(Kinder-Dips2)                1095
 9 Minidips-Kat6                                 957
10 EG_KiJu_Krise                                 740
# ℹ 92 more rows</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#work with assessment_type "Diagnostisches Interview ab ..."</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co">#remove non-relevant assessment types (e.g.from children and adolesent database, assessment types with very little cases) and assessment names ()</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>dsmv_filtered <span class="ot">&lt;-</span> dsmv_master <span class="sc">|&gt;</span> </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(assessment_name <span class="sc">==</span> <span class="st">"DSM V"</span> <span class="sc">&amp;</span> assessment_type <span class="sc">==</span> <span class="st">"Diagnostisches Interview ab 01.04.2017"</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>dsmv_filtered_wider <span class="ot">&lt;-</span> dsmv_filtered <span class="sc">|&gt;</span> </span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(case_nr, patient_chiffre, patient_dateofbirth, patient_sex, therapist_dateofbirth, therapist_sex, assessment_date), <span class="at">names_from =</span> item_no, <span class="at">values_from =</span> <span class="fu">c</span>(treenodepath, answerscale_value)) <span class="sc">|&gt;</span> </span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(answerscale_value_5, <span class="at">names_sep =</span> <span class="st">"_"</span>) <span class="sc">|&gt;</span> <span class="co">#split up list-columns for cases with comorbidity</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(answerscale_value_6, <span class="at">names_sep =</span> <span class="st">"_"</span>) <span class="sc">|&gt;</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(answerscale_value_7, <span class="at">names_sep =</span> <span class="st">"_"</span>) <span class="sc">|&gt;</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(answerscale_value_8, <span class="at">names_sep =</span> <span class="st">"_"</span>) <span class="sc">|&gt;</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(answerscale_value_9, <span class="at">names_sep =</span> <span class="st">"_"</span>) <span class="sc">|&gt;</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(answerscale_value_10, <span class="at">names_sep =</span> <span class="st">"_"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">assessment_date_DI =</span> <span class="st">"assessment_date"</span>, <span class="at">dsmv_diagnosis_1 =</span> <span class="st">"answerscale_value_5_1"</span>, <span class="at">dsmv_diagnosis_2 =</span> <span class="st">"answerscale_value_5_2"</span>,<span class="at">dsmv_diagnosis_3 =</span> <span class="st">"answerscale_value_5_3"</span>,<span class="at">dsmv_diagnosis_4 =</span> <span class="st">"answerscale_value_5_4"</span>,<span class="at">dsmv_diagnosis_5 =</span> <span class="st">"answerscale_value_5_5"</span>,<span class="at">dsmv_diagnosis_6 =</span> <span class="st">"answerscale_value_5_6"</span>,<span class="at">dsmv_diagnosis_7 =</span> <span class="st">"answerscale_value_5_7"</span>, <span class="at">dsmv_diagnosis_1_severity =</span> <span class="st">"answerscale_value_6_1"</span>, <span class="at">dsmv_diagnosis_2_severity =</span> <span class="st">"answerscale_value_6_2"</span>, <span class="at">dsmv_diagnosis_3_severity =</span> <span class="st">"answerscale_value_6_3"</span>, <span class="at">dsmv_diagnosis_4_severity =</span> <span class="st">"answerscale_value_6_4"</span>, <span class="at">dsmv_diagnosis_5_severity =</span> <span class="st">"answerscale_value_6_5"</span>, <span class="at">dsmv_diagnosis_6_severity =</span> <span class="st">"answerscale_value_6_6"</span>, <span class="at">dsmv_diagnosis_7_severity =</span> <span class="st">"answerscale_value_6_7"</span>, <span class="at">dsmv_diagnosis_1_confidence =</span> <span class="st">"answerscale_value_7_1"</span>, <span class="at">dsmv_diagnosis_2_confidence =</span> <span class="st">"answerscale_value_7_2"</span>, <span class="at">dsmv_diagnosis_3_confidence =</span> <span class="st">"answerscale_value_7_3"</span>, <span class="at">dsmv_diagnosis_4_confidence =</span> <span class="st">"answerscale_value_7_4"</span>, <span class="at">dsmv_diagnosis_5_confidence =</span> <span class="st">"answerscale_value_7_5"</span>, <span class="at">dsmv_diagnosis_6_confidence =</span> <span class="st">"answerscale_value_7_6"</span>, <span class="at">dsmv_diagnosis_7_confidence =</span> <span class="st">"answerscale_value_7_7"</span>, <span class="at">dsmv_diagnosis_1_type =</span> <span class="st">"answerscale_value_8_1"</span>, <span class="at">dsmv_diagnosis_2_type =</span> <span class="st">"answerscale_value_8_2"</span>, <span class="at">dsmv_diagnosis_3_type =</span> <span class="st">"answerscale_value_8_3"</span>, <span class="at">dsmv_diagnosis_4_type =</span> <span class="st">"answerscale_value_8_4"</span>, <span class="at">dsmv_diagnosis_5_type =</span> <span class="st">"answerscale_value_8_5"</span>, <span class="at">dsmv_diagnosis_6_type =</span> <span class="st">"answerscale_value_8_6"</span>, <span class="at">dsmv_diagnosis_7_type =</span> <span class="st">"answerscale_value_8_7"</span>, <span class="at">dsmv_diagnosis_1_reason_for_therapy =</span> <span class="st">"answerscale_value_9_1"</span>, <span class="at">dsmv_diagnosis_2_reason_for_therapy =</span> <span class="st">"answerscale_value_9_2"</span>, <span class="at">dsmv_diagnosis_3_reason_for_therapy =</span> <span class="st">"answerscale_value_9_3"</span>, <span class="at">dsmv_diagnosis_4_reason_for_therapy =</span> <span class="st">"answerscale_value_9_4"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(case_nr, patient_chiffre, patient_dateofbirth, patient_sex, therapist_dateofbirth, therapist_sex, assessment_date_DI, dsmv_diagnosis_1, dsmv_diagnosis_1_severity, dsmv_diagnosis_1_confidence, dsmv_diagnosis_1_type, dsmv_diagnosis_1_reason_for_therapy, dsmv_diagnosis_2, dsmv_diagnosis_2_severity, dsmv_diagnosis_2_confidence, dsmv_diagnosis_2_type, dsmv_diagnosis_2_reason_for_therapy, dsmv_diagnosis_3, dsmv_diagnosis_3_severity, dsmv_diagnosis_3_confidence, dsmv_diagnosis_3_type, dsmv_diagnosis_3_reason_for_therapy, dsmv_diagnosis_4, dsmv_diagnosis_4_severity, dsmv_diagnosis_4_confidence, dsmv_diagnosis_4_type, dsmv_diagnosis_4_reason_for_therapy, dsmv_diagnosis_5, dsmv_diagnosis_5_severity, dsmv_diagnosis_5_confidence, dsmv_diagnosis_5_type, dsmv_diagnosis_6, dsmv_diagnosis_6_severity, dsmv_diagnosis_6_confidence, dsmv_diagnosis_6_type, dsmv_diagnosis_7, dsmv_diagnosis_7_severity, dsmv_diagnosis_7_confidence, dsmv_diagnosis_7_type)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Values from `answerscale_value` and `treenodepath` are not uniquely identified;
output will contain list-cols.
• Use `values_fn = list` to suppress this warning.
• Use `values_fn = {summary_fun}` to summarise duplicates.
• Use the following dplyr code to identify duplicates.
  {data} |&gt;
  dplyr::summarise(n = dplyr::n(), .by = c(case_nr, patient_chiffre,
  patient_dateofbirth, patient_sex, therapist_dateofbirth, therapist_sex,
  assessment_date, item_no)) |&gt;
  dplyr::filter(n &gt; 1L)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># replace arbitrary numeric codes with diagnostic labels from the codebook</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co"># create lookup vector from codebook</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>lookup <span class="ot">&lt;-</span> <span class="fu">setNames</span>(dsmv_codebook<span class="sc">$</span>dsmv_diagnosis, dsmv_codebook<span class="sc">$</span>scalevalue)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># replace numeric codes with labels from lookup vector</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>dsmv_filtered_wider_labeled <span class="ot">&lt;-</span> dsmv_filtered_wider <span class="sc">|&gt;</span> </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(dsmv_diagnosis_1, dsmv_diagnosis_2, dsmv_diagnosis_3, dsmv_diagnosis_4, dsmv_diagnosis_5, dsmv_diagnosis_6, dsmv_diagnosis_7),</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>                <span class="sc">~</span> lookup[<span class="fu">as.character</span>(.)]))</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="co"># transform to factors with labels</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co">#patient_sex</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>dsmv_filtered_wider_labeled<span class="sc">$</span>patient_sex <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tolower</span>(dsmv_filtered_wider_labeled<span class="sc">$</span>patient_sex), <span class="co"># convert "M"→"m", "F"→"f"</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"m"</span>, <span class="st">"w"</span>),</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"male"</span>, <span class="st">"female"</span>)</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="co">#therapist_sex</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>dsmv_filtered_wider_labeled<span class="sc">$</span>therapist_sex <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tolower</span>(dsmv_filtered_wider_labeled<span class="sc">$</span>therapist_sex),</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"m"</span>, <span class="st">"w"</span>),</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"male"</span>, <span class="st">"female"</span>)</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a><span class="co"># set labels</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>dsmv_diagnosis_type_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"1"</span> <span class="ot">=</span> <span class="st">"primary diagnosis"</span>, <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"secondary diagnosis"</span>, <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"lifetime diagnosis"</span>)</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>dsmv_diagnosis_reason_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"1"</span> <span class="ot">=</span> <span class="st">"yes"</span>, <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"no"</span>)</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_1_type <span class="ot">&lt;-</span> <span class="fu">factor</span>(dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_1_type, <span class="at">levels =</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(dsmv_diagnosis_type_labels)), <span class="at">labels =</span> dsmv_diagnosis_type_labels)</span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_2_type <span class="ot">&lt;-</span> <span class="fu">factor</span>(dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_2_type, <span class="at">levels =</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(dsmv_diagnosis_type_labels)), <span class="at">labels =</span> dsmv_diagnosis_type_labels)</span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_3_type <span class="ot">&lt;-</span> <span class="fu">factor</span>(dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_3_type, <span class="at">levels =</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(dsmv_diagnosis_type_labels)), <span class="at">labels =</span> dsmv_diagnosis_type_labels)</span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_4_type <span class="ot">&lt;-</span> <span class="fu">factor</span>(dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_4_type, <span class="at">levels =</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(dsmv_diagnosis_type_labels)), <span class="at">labels =</span> dsmv_diagnosis_type_labels)</span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_5_type <span class="ot">&lt;-</span> <span class="fu">factor</span>(dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_5_type, <span class="at">levels =</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(dsmv_diagnosis_type_labels)), <span class="at">labels =</span> dsmv_diagnosis_type_labels)</span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_6_type <span class="ot">&lt;-</span> <span class="fu">factor</span>(dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_6_type, <span class="at">levels =</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(dsmv_diagnosis_type_labels)), <span class="at">labels =</span> dsmv_diagnosis_type_labels)</span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a>dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_7_type <span class="ot">&lt;-</span> <span class="fu">factor</span>(dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_7_type, <span class="at">levels =</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(dsmv_diagnosis_type_labels)), <span class="at">labels =</span> dsmv_diagnosis_type_labels)</span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a>dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_1_reason_for_therapy <span class="ot">&lt;-</span> <span class="fu">factor</span>(dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_1_reason_for_therapy, <span class="at">levels =</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(dsmv_diagnosis_reason_labels)), <span class="at">labels =</span> dsmv_diagnosis_reason_labels)</span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a>dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_2_reason_for_therapy <span class="ot">&lt;-</span> <span class="fu">factor</span>(dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_2_reason_for_therapy, <span class="at">levels =</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(dsmv_diagnosis_reason_labels)), <span class="at">labels =</span> dsmv_diagnosis_reason_labels)</span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a>dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_3_reason_for_therapy <span class="ot">&lt;-</span> <span class="fu">factor</span>(dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_3_reason_for_therapy, <span class="at">levels =</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(dsmv_diagnosis_reason_labels)), <span class="at">labels =</span> dsmv_diagnosis_reason_labels)</span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a>dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_4_reason_for_therapy <span class="ot">&lt;-</span> <span class="fu">factor</span>(dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_4_reason_for_therapy, <span class="at">levels =</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(dsmv_diagnosis_reason_labels)), <span class="at">labels =</span> dsmv_diagnosis_reason_labels)</span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a><span class="co"># create variables patient_age_therapy_start and therapist_age_therapy_start</span></span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a>dsmv_filtered_wider_labeled <span class="ot">&lt;-</span> dsmv_filtered_wider_labeled <span class="sc">|&gt;</span></span>
<span id="cb25-55"><a href="#cb25-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb25-56"><a href="#cb25-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">patient_dateofbirth =</span> <span class="fu">as.Date</span>(patient_dateofbirth),</span>
<span id="cb25-57"><a href="#cb25-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">therapist_dateofbirth =</span> <span class="fu">as.Date</span>(therapist_dateofbirth),</span>
<span id="cb25-58"><a href="#cb25-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">assessment_date_DI =</span> <span class="fu">as.Date</span>(assessment_date_DI),</span>
<span id="cb25-59"><a href="#cb25-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">patient_age_therapy_start =</span> <span class="fu">floor</span>(<span class="fu">time_length</span>(<span class="fu">interval</span>(patient_dateofbirth, assessment_date_DI), <span class="st">"years"</span>)),</span>
<span id="cb25-60"><a href="#cb25-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">therapist_age_therapy_start =</span> <span class="fu">floor</span>(<span class="fu">time_length</span>(<span class="fu">interval</span>(therapist_dateofbirth, assessment_date_DI), <span class="st">"years"</span>))</span>
<span id="cb25-61"><a href="#cb25-61" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb25-62"><a href="#cb25-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(case_nr, patient_chiffre, patient_sex, patient_dateofbirth, patient_age_therapy_start, therapist_dateofbirth, therapist_age_therapy_start, <span class="fu">everything</span>())</span>
<span id="cb25-63"><a href="#cb25-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-64"><a href="#cb25-64" aria-hidden="true" tabindex="-1"></a><span class="co"># de-identify patient and therapist date of birth</span></span>
<span id="cb25-65"><a href="#cb25-65" aria-hidden="true" tabindex="-1"></a>dsmv_filtered_wider_labeled<span class="sc">$</span>patient_dateofbirth <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">format</span>(<span class="fu">as.Date</span>(dsmv_filtered_wider_labeled<span class="sc">$</span>patient_dateofbirth), <span class="st">"%Y"</span>))</span>
<span id="cb25-66"><a href="#cb25-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-67"><a href="#cb25-67" aria-hidden="true" tabindex="-1"></a>dsmv_filtered_wider_labeled<span class="sc">$</span>therapist_dateofbirth <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">format</span>(<span class="fu">as.Date</span>(dsmv_filtered_wider_labeled<span class="sc">$</span>therapist_dateofbirth), <span class="st">"%Y"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div></div>
</section>
<section id="bdi-ii" class="level3">
<h3 class="anchored" data-anchor-id="bdi-ii">BDI II</h3>
<div class="cell-container"><div class="cell-decorator"><pre>In [5]:</pre></div><div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>bdi_master <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"/Volumes/meta_data/raw/raw_selfreport/BDI II_ab2017.xlsx"</span>,</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">"case_nr"</span>, <span class="st">"patient_chiffre"</span>,<span class="st">"patient_sex"</span>,<span class="st">"patient_dateofbirth"</span>,<span class="st">"assessment_date"</span>,<span class="st">"assessment_type"</span>,<span class="st">"assessment_id"</span>,<span class="st">"assessment_name"</span>,<span class="st">"item_no"</span>,<span class="st">"answerscale_value"</span>,<span class="st">"therapist_no"</span>,<span class="st">"therapist_sex"</span>,<span class="st">"therapist_dateofbirth"</span>),</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">skip =</span> <span class="dv">1</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co">#how many patients are there for each assessment type?</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>bdi_master <span class="sc">|&gt;</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_patients =</span> <span class="fu">n_distinct</span>(case_nr),</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> assessment_type</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n_patients))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 49 × 2
   assessment_type n_patients
   &lt;chr&gt;                &lt;int&gt;
 1 DU-Prä                3036
 2 KZT1-DUPost           2122
 3 KZT2-DUPost           1667
 4 KZT1-DU4              1431
 5 DU-Kat6               1034
 6 LZT1-DUPost            797
 7 LZT-DU40               464
 8 DU-Post                254
 9 LZT2-DUPost            204
10 DU30_Erwachsene        184
# ℹ 39 more rows</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">#remove non-relevant assessment types (e.g.from children and adolesent database, group sessions, assessment types with very little cases) </span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>bdi_erw <span class="ot">&lt;-</span> bdi_master <span class="sc">|&gt;</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(assessment_type, <span class="st">"KiJu|Krisen|DU-POST2|Gruppe|Einzeltherapiesitzung|Weitere|DU-4|DU-8|DU-12|DU-24|Erwachsene|Du-Post-KZT1|DU-Kat12|DU-Kat24|Interview|Abrechnung|außerplanmäßig|LZT-DU12|LZT-DU24|LZT-DU4|DU-Post"</span>))</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>bdi_erw <span class="sc">|&gt;</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(case_nr, assessment_type) <span class="sc">|&gt;</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n_distinct</span>(assessment_date, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(patient_chiffre, assessment_type, assessment_date) <span class="sc">|&gt;</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(patient_chiffre, assessment_type, assessment_date)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 3
   patient_chiffre assessment_type assessment_date    
   &lt;chr&gt;           &lt;chr&gt;           &lt;dttm&gt;             
 1 A160698         LZT2-DUPost     2023-01-19 00:00:00
 2 A160698         LZT2-DUPost     2023-09-26 00:00:00
 3 B300985         KZT1-DU4        2017-06-27 00:00:00
 4 B300985         KZT1-DU4        2017-08-01 00:00:00
 5 H281139         DU-Prä          2017-10-13 00:00:00
 6 H281139         DU-Prä          2019-05-21 00:00:00
 7 L240293         DU-Prä          2021-11-03 00:00:00
 8 L240293         DU-Prä          2023-06-07 00:00:00
 9 N221187         DU-Prä          2022-10-26 00:00:00
10 N221187         DU-Prä          2024-05-02 00:00:00
11 R200472         DU-Prä          2019-05-10 00:00:00
12 R200472         DU-Prä          2021-03-09 00:00:00
13 S150380         DU-Kat6         2021-10-01 00:00:00
14 S150380         DU-Kat6         2023-10-16 00:00:00
15 S190600         DU-Prä          2022-05-19 00:00:00
16 S190600         DU-Prä          2023-12-19 00:00:00
17 S260891         DU-Prä          2017-05-16 00:00:00
18 S260891         DU-Prä          2019-05-08 00:00:00
19 S281197         DU-Kat6         2022-06-20 00:00:00
20 S281197         DU-Kat6         2024-03-18 00:00:00</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if one single chiffre is related to several case_nrs? </span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>bdi_erw <span class="sc">|&gt;</span> </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_chiffre =</span> <span class="fu">n_distinct</span>(patient_chiffre), </span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> case_nr) <span class="sc">|&gt;</span> </span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">anzahl =</span> <span class="fu">n</span>(), </span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">.by =</span> n_chiffre)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  n_chiffre anzahl
      &lt;int&gt;  &lt;int&gt;
1         1   3263</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if one single case_nr is related to several patient_chiffres.</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>bdi_erw <span class="sc">|&gt;</span> </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_cases =</span> <span class="fu">n_distinct</span>(case_nr),</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> patient_chiffre) <span class="sc">|&gt;</span> </span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">anzahl =</span> <span class="fu">n</span>(),</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">.by =</span> n_cases)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  n_cases anzahl
    &lt;int&gt;  &lt;int&gt;
1       1   2934
2       2    154
3       3      7</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate BDI sum scores</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>bdi_erw_sum <span class="ot">&lt;-</span> bdi_erw <span class="sc">|&gt;</span> </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">patient_chiffre =</span> <span class="fu">first</span>(patient_chiffre),</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">patient_sex =</span> <span class="fu">first</span>(patient_sex),</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">patient_dateofbirth =</span> <span class="fu">first</span>(patient_dateofbirth),</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">bdi_sum =</span> <span class="fu">sum</span>(answerscale_value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">assessment_date =</span> <span class="fu">first</span>(assessment_date),</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">therapist_sex =</span> <span class="fu">first</span>(therapist_sex),</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">therapist_dateofbirth =</span> <span class="fu">first</span>(therapist_dateofbirth),</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> <span class="fu">c</span>(case_nr,assessment_type)</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  )  <span class="sc">|&gt;</span> </span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(case_nr, patient_chiffre, patient_dateofbirth, patient_sex, assessment_type, bdi_sum, assessment_date, therapist_dateofbirth, therapist_sex)</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="co"># pivot df to have one case_nr in each row</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>bdi_wider <span class="ot">&lt;-</span> bdi_erw_sum <span class="sc">|&gt;</span> </span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(case_nr), <span class="at">names_from =</span> assessment_type, <span class="at">values_from =</span> <span class="fu">c</span>(bdi_sum, assessment_date)) <span class="sc">|&gt;</span>  <span class="co">#remove redundant variables (date of birth, sex, etc.) for merging with other self-rating df's </span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(case_nr, <span class="st">"bdi_sum_DU-Prä"</span>, <span class="st">"assessment_date_DU-Prä"</span>, <span class="st">"bdi_sum_KZT1-DU4"</span>, <span class="st">"assessment_date_KZT1-DU4"</span>, <span class="st">"bdi_sum_KZT1-DUPost"</span>, <span class="st">"assessment_date_KZT1-DUPost"</span>, <span class="st">"bdi_sum_KZT2-DUPost"</span>, <span class="st">"assessment_date_KZT2-DUPost"</span>, <span class="st">"bdi_sum_LZT1-DUPost"</span>, <span class="st">"assessment_date_LZT1-DUPost"</span>, <span class="st">"bdi_sum_LZT2-DUPost"</span>,<span class="st">"assessment_date_LZT2-DUPost"</span> ,<span class="st">"bdi_sum_DU-Kat6"</span>, <span class="st">"assessment_date_DU-Kat6"</span>)</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a><span class="co">#exclude cases without pre-measurement (most of the time cases where therapy startet before 2017)</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>bdi_wider_complete <span class="ot">&lt;-</span> bdi_wider <span class="sc">|&gt;</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="st">`</span><span class="at">bdi_sum_DU-Prä</span><span class="st">`</span>))</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a><span class="co">#how many cases are there in the dataset for each assessment type?</span></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>bdi_wider_complete <span class="sc">|&gt;</span> </span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"bdi_sum_"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span><span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(.))))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 7
  `bdi_sum_DU-Prä` `bdi_sum_KZT1-DU4` `bdi_sum_KZT1-DUPost`
             &lt;int&gt;              &lt;int&gt;                 &lt;int&gt;
1             3036               1422                  2086
# ℹ 4 more variables: `bdi_sum_KZT2-DUPost` &lt;int&gt;, `bdi_sum_LZT1-DUPost` &lt;int&gt;,
#   `bdi_sum_LZT2-DUPost` &lt;int&gt;, `bdi_sum_DU-Kat6` &lt;int&gt;</code></pre>
</div>
</div></div>
</section>
<section id="bsi" class="level3">
<h3 class="anchored" data-anchor-id="bsi">BSI</h3>
<div class="cell-container"><div class="cell-decorator"><pre>In [6]:</pre></div><div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>bsi_master <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"/Volumes/meta_data/raw/raw_selfreport/BSI_ab2017.xlsx"</span>, </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">"case_nr"</span>, <span class="st">"patient_chiffre"</span>, <span class="st">"patient_sex"</span>, <span class="st">"patient_dateofbirth"</span>, <span class="st">"assessment_date"</span>, <span class="st">"assessment_type"</span>, <span class="st">"assessment_id"</span>, <span class="st">"assessment_name"</span>, <span class="st">"item_no"</span>, <span class="st">"answerscale_value"</span>, <span class="st">"therapist_no"</span>, <span class="st">"therapist_sex"</span>, <span class="st">"therapist_dateofbirth"</span>), </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">skip =</span> <span class="dv">1</span>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co">#how many patients are there for each assessment type?</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>bsi_master <span class="sc">|&gt;</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_patients =</span> <span class="fu">n_distinct</span>(case_nr),</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> assessment_type</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n_patients))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 47 × 2
   assessment_type                        n_patients
   &lt;chr&gt;                                       &lt;int&gt;
 1 Diagnostisches Interview ab 01.04.2017       2238
 2 KZT1-DUPost                                  2130
 3 KZT2-DUPost                                  1662
 4 KZT1-DU4                                     1434
 5 DU-Kat6                                      1065
 6 DU-Kat12                                      853
 7 LZT1-DUPost                                   800
 8 DU-Kat24                                      675
 9 LZT-DU40                                      464
10 DU-Post                                       263
# ℹ 37 more rows</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">#remove non-relevant assessment types (e.g.from children and adolesent database, group sessions, assessment types with very little cases) </span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>bsi_erw <span class="ot">&lt;-</span> bsi_master <span class="sc">|&gt;</span> </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(assessment_type <span class="sc">==</span> <span class="st">"Diagnostisches Interview ab 01.04.2017"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"KZT1-DU4"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"KZT1-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"KZT2-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"LZT1-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"LZT2-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"DU-Kat6"</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>bsi_erw <span class="sc">|&gt;</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(case_nr, assessment_type) <span class="sc">|&gt;</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n_distinct</span>(assessment_date, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(patient_chiffre, assessment_type, assessment_date) <span class="sc">|&gt;</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(patient_chiffre, assessment_type, assessment_date)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
   patient_chiffre assessment_type                        assessment_date    
   &lt;chr&gt;           &lt;chr&gt;                                  &lt;dttm&gt;             
 1 A160698         LZT2-DUPost                            2023-01-19 00:00:00
 2 A160698         LZT2-DUPost                            2023-09-26 00:00:00
 3 B300985         KZT1-DU4                               2017-06-27 00:00:00
 4 B300985         KZT1-DU4                               2017-08-01 00:00:00
 5 S150380         DU-Kat6                                2021-10-01 00:00:00
 6 S150380         DU-Kat6                                2023-10-16 00:00:00
 7 S281197         DU-Kat6                                2022-06-20 00:00:00
 8 S281197         DU-Kat6                                2024-03-18 00:00:00
 9 W210465         Diagnostisches Interview ab 01.04.2017 2017-06-23 00:00:00
10 W210465         Diagnostisches Interview ab 01.04.2017 2019-04-02 00:00:00</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>bsi_erw_gsi <span class="ot">&lt;-</span> bsi_erw <span class="sc">|&gt;</span> </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>item_no <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"54"</span>, <span class="st">"55"</span>, <span class="st">"11"</span>, <span class="st">"25"</span>, <span class="st">"39"</span>, <span class="st">"52"</span>)) <span class="sc">|&gt;</span>  <span class="co">#items 54 and 55 don't belong to the bsi and 11, 25, 39 and 52 are not used for calculating the GSI</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">bsi_gsi =</span> <span class="fu">mean</span>(answerscale_value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">assessment_date =</span> <span class="fu">first</span>(assessment_date),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> <span class="fu">c</span>(case_nr,assessment_type)</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  )  <span class="sc">|&gt;</span> </span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(case_nr, assessment_type, bsi_gsi, assessment_date)</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="co"># pivot df to have one case_nr in each row</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>bsi_wider <span class="ot">&lt;-</span> bsi_erw_gsi <span class="sc">|&gt;</span> </span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(case_nr), <span class="at">names_from =</span> assessment_type, <span class="at">values_from =</span> <span class="fu">c</span>(bsi_gsi, assessment_date)) <span class="sc">|&gt;</span> </span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">assessment_date_DI =</span> <span class="st">"assessment_date_Diagnostisches Interview ab 01.04.2017"</span>, <span class="at">bsi_gsi_DI =</span> <span class="st">"bsi_gsi_Diagnostisches Interview ab 01.04.2017"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(case_nr, bsi_gsi_DI, <span class="st">`</span><span class="at">bsi_gsi_KZT1-DU4</span><span class="st">`</span>, <span class="st">`</span><span class="at">bsi_gsi_KZT1-DUPost</span><span class="st">`</span>, <span class="st">`</span><span class="at">bsi_gsi_KZT2-DUPost</span><span class="st">`</span>, <span class="st">`</span><span class="at">bsi_gsi_LZT1-DUPost</span><span class="st">`</span>, <span class="st">`</span><span class="at">bsi_gsi_LZT2-DUPost</span><span class="st">`</span>, <span class="st">`</span><span class="at">bsi_gsi_DU-Kat6</span><span class="st">`</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div></div>
</section>
<section id="dass-42" class="level3">
<h3 class="anchored" data-anchor-id="dass-42">DASS-42</h3>
<div class="cell-container"><div class="cell-decorator"><pre>In [7]:</pre></div><div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>dass_master <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"/Volumes/meta_data/raw/raw_selfreport/DASS_ab2017.xlsx"</span>,</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">"case_nr"</span>, <span class="st">"patient_chiffre"</span>,<span class="st">"patient_sex"</span>,<span class="st">"patient_dateofbirth"</span>,<span class="st">"assessment_date"</span>,<span class="st">"assessment_type"</span>,<span class="st">"assessment_id"</span>,<span class="st">"assessment_name"</span>,<span class="st">"item_no"</span>,<span class="st">"answerscale_value"</span>,<span class="st">"therapist_no"</span>,<span class="st">"therapist_sex"</span>,<span class="st">"therapist_dateofbirth"</span>),</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">skip =</span> <span class="dv">1</span>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co">#how many patients are there for each assessment type?</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>dass_master <span class="sc">|&gt;</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_patients =</span> <span class="fu">n_distinct</span>(case_nr),</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> assessment_type</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n_patients))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 32 × 2
   assessment_type n_patients
   &lt;chr&gt;                &lt;int&gt;
 1 DU-Prä                3013
 2 KZT1-DUPost           2093
 3 KZT2-DUPost           1646
 4 KZT1-DU4              1428
 5 DU-Kat6               1068
 6 DU-Kat12               856
 7 LZT1-DUPost            791
 8 DU-Kat24               678
 9 LZT-DU40               459
10 DU-Post                263
# ℹ 22 more rows</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>dass_erw <span class="ot">&lt;-</span> dass_master <span class="sc">|&gt;</span> </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(assessment_name <span class="sc">==</span> <span class="st">"DASS-42-G"</span> <span class="sc">&amp;</span> (assessment_type <span class="sc">==</span> <span class="st">"DU-Prä"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"KZT1-DU4"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"KZT1-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"KZT2-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"LZT1-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"LZT2-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"DU-Kat6"</span>))</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>dass_erw_score <span class="ot">&lt;-</span> dass_erw <span class="sc">|&gt;</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">patient_chiffre =</span> <span class="fu">first</span>(patient_chiffre),</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">dass_total_score =</span> <span class="fu">sum</span>(answerscale_value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">dass_dep_score =</span> <span class="fu">sum</span>(</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>      answerscale_value[item_no <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">13</span>, <span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">21</span>, <span class="dv">24</span>, <span class="dv">26</span>, <span class="dv">31</span>, <span class="dv">34</span>, <span class="dv">37</span>, <span class="dv">38</span>, <span class="dv">42</span>)],</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">dass_anx_score =</span> <span class="fu">sum</span>(</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>      answerscale_value[item_no <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">9</span>, <span class="dv">15</span>, <span class="dv">19</span>, <span class="dv">20</span>, <span class="dv">23</span>, <span class="dv">25</span>, <span class="dv">28</span>, <span class="dv">30</span>, <span class="dv">36</span>, <span class="dv">40</span>, <span class="dv">41</span>)],</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">dass_str_score =</span> <span class="fu">sum</span>(</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>      answerscale_value[item_no <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">14</span>, <span class="dv">18</span>, <span class="dv">22</span>, <span class="dv">27</span>, <span class="dv">29</span>, <span class="dv">32</span>, <span class="dv">33</span>, <span class="dv">35</span>, <span class="dv">39</span>)],</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">assessment_date =</span> <span class="fu">first</span>(assessment_date),</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> <span class="fu">c</span>(case_nr, assessment_type)</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>    case_nr, assessment_type, dass_total_score, dass_dep_score, dass_anx_score, dass_str_score, assessment_date</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>dass_wider <span class="ot">&lt;-</span> dass_erw_score <span class="sc">|&gt;</span> </span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(case_nr), <span class="at">names_from =</span> assessment_type, <span class="at">values_from =</span> <span class="fu">c</span>(dass_total_score, dass_dep_score, dass_anx_score, dass_str_score, assessment_date)) <span class="sc">|&gt;</span> </span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(case_nr, <span class="st">`</span><span class="at">dass_total_score_DU-Prä</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_dep_score_DU-Prä</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_anx_score_DU-Prä</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_str_score_DU-Prä</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_total_score_KZT1-DU4</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_dep_score_KZT1-DU4</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_anx_score_KZT1-DU4</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_str_score_KZT1-DU4</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_total_score_KZT1-DUPost</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_dep_score_KZT1-DUPost</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_anx_score_KZT1-DUPost</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_str_score_KZT1-DUPost</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_total_score_KZT2-DUPost</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_dep_score_KZT2-DUPost</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_anx_score_KZT2-DUPost</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_str_score_KZT2-DUPost</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_total_score_LZT1-DUPost</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_dep_score_LZT1-DUPost</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_anx_score_LZT1-DUPost</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_str_score_LZT1-DUPost</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_total_score_LZT2-DUPost</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_dep_score_LZT2-DUPost</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_anx_score_LZT2-DUPost</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_str_score_LZT2-DUPost</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_total_score_DU-Kat6</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_dep_score_DU-Kat6</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_anx_score_DU-Kat6</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_str_score_DU-Kat6</span><span class="st">`</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div></div>
</section>
<section id="gas" class="level3">
<h3 class="anchored" data-anchor-id="gas">GAS</h3>
<div class="cell-container"><div class="cell-decorator"><pre>In [8]:</pre></div><div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>gas_master <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"/Volumes/meta_data/raw/raw_selfreport/GAS_ab2017.xlsx"</span>,</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">"case_nr"</span>, <span class="st">"patient_chiffre"</span>,<span class="st">"patient_sex"</span>,<span class="st">"patient_dateofbirth"</span>,<span class="st">"assessment_date"</span>,<span class="st">"assessment_type"</span>,<span class="st">"assessment_id"</span>,<span class="st">"assessment_name"</span>,<span class="st">"item_no"</span>,<span class="st">"answerscale_value"</span>,<span class="st">"therapist_no"</span>,<span class="st">"therapist_sex"</span>,<span class="st">"therapist_dateofbirth"</span>),</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">skip =</span> <span class="dv">1</span>)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co">#how many patients are there for each assessment type?</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>gas_master <span class="sc">|&gt;</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_patients =</span> <span class="fu">n_distinct</span>(case_nr),</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> assessment_type</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n_patients))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 31 × 2
   assessment_type n_patients
   &lt;chr&gt;                &lt;int&gt;
 1 KZT1-DUPost           1567
 2 KZT2-DUPost           1308
 3 LZT1-DUPost            663
 4 DU-Kat6                627
 5 DU-Kat12               452
 6 LZT-DU40               395
 7 DU-Kat24               322
 8 DU-Post                241
 9 DU30_Erwachsene        175
10 DU20_Erwachsene        164
# ℹ 21 more rows</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>gas_pt <span class="ot">&lt;-</span> gas_master <span class="sc">|&gt;</span> </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(assessment_name <span class="sc">==</span> <span class="st">"GAS-PT"</span> <span class="sc">&amp;</span> (assessment_type <span class="sc">==</span> <span class="st">"KZT1-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"KZT2-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"LZT1-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"LZT2-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"DU-Kat6"</span>))</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>gas_pt_mean <span class="ot">&lt;-</span> gas_pt <span class="sc">|&gt;</span> </span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">answerscale_value =</span> answerscale_value <span class="sc">-</span> <span class="dv">2</span>) <span class="sc">|&gt;</span> <span class="co">#recoding patient scaling (1-6) to be consistent with patient scaling (-1-4)</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">gas_pt_mean =</span> <span class="fu">mean</span>(answerscale_value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">assessment_date =</span> <span class="fu">first</span>(assessment_date),</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> <span class="fu">c</span>(case_nr,assessment_type)</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>  )  <span class="sc">|&gt;</span> </span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(case_nr, assessment_type, gas_pt_mean, assessment_date)</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>gas_th <span class="ot">&lt;-</span> gas_master <span class="sc">|&gt;</span> </span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(assessment_name <span class="sc">==</span> <span class="st">"GAS-TH"</span> <span class="sc">&amp;</span> (assessment_type <span class="sc">==</span> <span class="st">"KZT1-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"KZT2-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"LZT1-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"LZT2-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"DU-Kat6"</span>))</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>gas_th_mean <span class="ot">&lt;-</span> gas_th <span class="sc">|&gt;</span> </span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">gas_th_mean =</span> <span class="fu">mean</span>(answerscale_value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">assessment_date =</span> <span class="fu">first</span>(assessment_date),</span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> <span class="fu">c</span>(case_nr,assessment_type)</span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>  )  <span class="sc">|&gt;</span> </span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(case_nr, assessment_type, gas_th_mean, assessment_date)</span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>gas_mean <span class="ot">&lt;-</span> gas_pt_mean <span class="sc">|&gt;</span> </span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(gas_th_mean, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"case_nr"</span>, <span class="st">"assessment_type"</span>, <span class="st">"assessment_date"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(case_nr, assessment_date, assessment_type, gas_pt_mean, gas_th_mean)</span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a>gas_wider <span class="ot">&lt;-</span> gas_mean <span class="sc">|&gt;</span> </span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(case_nr), <span class="at">names_from =</span> assessment_type, <span class="at">values_from =</span> <span class="fu">c</span>(gas_pt_mean, gas_th_mean, assessment_date)) <span class="sc">|&gt;</span> </span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(case_nr, <span class="st">"gas_pt_mean_KZT1-DUPost"</span>, <span class="st">"gas_pt_mean_KZT2-DUPost"</span>, <span class="st">"gas_pt_mean_LZT1-DUPost"</span>, <span class="st">"gas_pt_mean_LZT2-DUPost"</span>, <span class="st">"gas_pt_mean_DU-Kat6"</span>, <span class="st">"gas_th_mean_KZT1-DUPost"</span>, <span class="st">"gas_th_mean_KZT2-DUPost"</span>, <span class="st">"gas_th_mean_LZT1-DUPost"</span>, <span class="st">"gas_th_mean_LZT2-DUPost"</span>, <span class="st">"gas_th_mean_DU-Kat6"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div></div>
</section>
<section id="pmh" class="level3">
<h3 class="anchored" data-anchor-id="pmh">PMH</h3>
<div class="cell-container"><div class="cell-decorator"><pre>In [9]:</pre></div><div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>pmh_master <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"/Volumes/meta_data/raw/raw_selfreport/Seelische_Gesundheit_ab2017.xlsx"</span>,</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">"case_nr"</span>, <span class="st">"patient_chiffre"</span>,<span class="st">"patient_sex"</span>,<span class="st">"patient_dateofbirth"</span>,<span class="st">"assessment_date"</span>,<span class="st">"assessment_type"</span>,<span class="st">"assessment_id"</span>,<span class="st">"assessment_name"</span>,<span class="st">"item_no"</span>,<span class="st">"answerscale_value"</span>,<span class="st">"therapist_no"</span>,<span class="st">"therapist_sex"</span>,<span class="st">"therapist_dateofbirth"</span>),</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">skip =</span> <span class="dv">1</span>)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="co">#how many patients are there for each assessment type?</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>pmh_master <span class="sc">|&gt;</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_patients =</span> <span class="fu">n_distinct</span>(case_nr),</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> assessment_type</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n_patients))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 33 × 2
   assessment_type n_patients
   &lt;chr&gt;                &lt;int&gt;
 1 DU-Prä                3017
 2 KZT1-DUPost           2116
 3 KZT2-DUPost           1658
 4 KZT1-DU4              1429
 5 DU-Kat6               1061
 6 DU-Kat12               854
 7 LZT1-DUPost            790
 8 DU-Kat24               667
 9 LZT-DU40               460
10 DU-Post                258
# ℹ 23 more rows</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>pmh_erw <span class="ot">&lt;-</span> pmh_master <span class="sc">|&gt;</span> </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(assessment_type <span class="sc">==</span> <span class="st">"DU-Prä"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"KZT1-DU4"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"KZT1-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"KZT2-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"LZT1-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"LZT2-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"DU-Kat6"</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="co"># PMH-Summenscore berechnen (Summe der Itemwerte je Fall und Assessment-Typ)</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>pmh_erw_sum <span class="ot">&lt;-</span> pmh_erw <span class="sc">|&gt;</span> </span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">assessment_date =</span> <span class="fu">first</span>(assessment_date),</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">pmh_sum =</span> <span class="fu">sum</span>(answerscale_value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> <span class="fu">c</span>(case_nr, assessment_type)</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a><span class="co"># pivot df to have one case_nr in each row</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>pmh_wider <span class="ot">&lt;-</span> pmh_erw_sum <span class="sc">|&gt;</span> </span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(case_nr), <span class="at">names_from =</span> assessment_type, <span class="at">values_from =</span> <span class="fu">c</span>(pmh_sum, assessment_date)) <span class="sc">|&gt;</span> </span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(case_nr, <span class="st">"pmh_sum_DU-Prä"</span>, <span class="st">"pmh_sum_KZT1-DU4"</span>, <span class="st">"pmh_sum_KZT1-DUPost"</span>, <span class="st">"pmh_sum_KZT2-DUPost"</span>, <span class="st">"pmh_sum_LZT1-DUPost"</span>, <span class="st">"pmh_sum_LZT2-DUPost"</span>, <span class="st">"pmh_sum_DU-Kat6"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div></div>
</section>
<section id="global-improvement" class="level3">
<h3 class="anchored" data-anchor-id="global-improvement">Global Improvement</h3>
<div class="cell-container"><div class="cell-decorator"><pre>In [10]:</pre></div><div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>glob_master <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"/Volumes/meta_data/raw/raw_selfreport/Globbeurteilung_SuccessRating_ab2017.xlsx"</span>,</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">"case_nr"</span>, <span class="st">"patient_chiffre"</span>,<span class="st">"patient_sex"</span>,<span class="st">"patient_dateofbirth"</span>,<span class="st">"assessment_date"</span>,<span class="st">"assessment_type"</span>,<span class="st">"assessment_id"</span>,<span class="st">"assessment_name"</span>,<span class="st">"item_no"</span>,<span class="st">"answerscale_value"</span>,<span class="st">"therapist_no"</span>,<span class="st">"therapist_sex"</span>,<span class="st">"therapist_dateofbirth"</span>),</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">skip =</span> <span class="dv">1</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="co">#how many patients are there for each assessment type? Therapist version is not assessed at FU measurements.</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>glob_master <span class="sc">|&gt;</span> </span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_patients =</span> <span class="fu">n_distinct</span>(case_nr),</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> assessment_type</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n_patients))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 28 × 2
   assessment_type n_patients
   &lt;chr&gt;                &lt;int&gt;
 1 KZT1-DUPost           2140
 2 KZT2-DUPost           1669
 3 DU-Kat6               1070
 4 DU-Kat12               855
 5 LZT1-DUPost            800
 6 DU-Kat24               678
 7 LZT-DU40               463
 8 DU-Post                264
 9 LZT2-DUPost            203
10 DU30_Erwachsene        184
# ℹ 18 more rows</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(glob_master<span class="sc">$</span>assessment_name)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Glob-Pt Globalbeurteilung"       "Glob-Th Globalbeurteilung"      
[3] "Global Success Rating - Patient"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co">#remove non-relevant assessment types (e.g.from children and adolesent database, group sessions, assessment types with very little cases) and assessment names (e.g. kodap pre)</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>glob_pt <span class="ot">&lt;-</span> glob_master <span class="sc">|&gt;</span> </span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(assessment_name <span class="sc">==</span> <span class="st">"Glob-Pt Globalbeurteilung"</span> <span class="sc">&amp;</span> (assessment_type <span class="sc">==</span> <span class="st">"KZT1-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"KZT2-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"LZT1-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"LZT2-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"DU-Kat6"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"DU-Kat12"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"DU-Kat24"</span>))</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>glob_pt_wider <span class="ot">&lt;-</span> glob_pt <span class="sc">|&gt;</span> </span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> case_nr, <span class="at">names_from =</span> <span class="fu">c</span>(item_no, assessment_type), <span class="at">values_from =</span> answerscale_value) <span class="sc">|&gt;</span> </span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"glob_pt_satisfaction_KZT1-DUPost"</span> <span class="ot">=</span> <span class="st">"1_KZT1-DUPost"</span>, <span class="st">"glob_pt_satisfaction_KZT2-DUPost"</span> <span class="ot">=</span> <span class="st">"1_KZT2-DUPost"</span>, <span class="st">"glob_pt_satisfaction_LZT1-DUPost"</span> <span class="ot">=</span> <span class="st">"1_LZT1-DUPost"</span>, <span class="st">"glob_pt_satisfaction_LZT2-DUPost"</span> <span class="ot">=</span> <span class="st">"1_LZT2-DUPost"</span>, <span class="st">"glob_pt_satisfaction_DU-Kat6"</span> <span class="ot">=</span> <span class="st">"1_DU-Kat6"</span>, <span class="st">"glob_pt_satisfaction_DU-Kat12"</span> <span class="ot">=</span> <span class="st">"1_DU-Kat12"</span>, <span class="st">"glob_pt_satisfaction_DU-Kat24"</span> <span class="ot">=</span> <span class="st">"1_DU-Kat24"</span>, <span class="st">"glob_pt_benefit_KZT1-DUPost"</span> <span class="ot">=</span> <span class="st">"2_KZT1-DUPost"</span>, <span class="st">"glob_pt_benefit_KZT2-DUPost"</span> <span class="ot">=</span> <span class="st">"2_KZT2-DUPost"</span>, <span class="st">"glob_pt_benefit_LZT1-DUPost"</span> <span class="ot">=</span> <span class="st">"2_LZT1-DUPost"</span>, <span class="st">"glob_pt_benefit_LZT2-DUPost"</span> <span class="ot">=</span> <span class="st">"2_LZT2-DUPost"</span>, <span class="st">"glob_pt_benefit_DU-Kat6"</span> <span class="ot">=</span> <span class="st">"2_DU-Kat6"</span>, <span class="st">"glob_pt_benefit_DU-Kat12"</span> <span class="ot">=</span> <span class="st">"2_DU-Kat12"</span>, <span class="st">"glob_pt_benefit_DU-Kat24"</span> <span class="ot">=</span> <span class="st">"2_DU-Kat24"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Values from `answerscale_value` are not uniquely identified; output will
contain list-cols.
• Use `values_fn = list` to suppress this warning.
• Use `values_fn = {summary_fun}` to summarise duplicates.
• Use the following dplyr code to identify duplicates.
  {data} |&gt;
  dplyr::summarise(n = dplyr::n(), .by = c(case_nr, item_no, assessment_type))
  |&gt;
  dplyr::filter(n &gt; 1L)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co">#remove non-relevant assessment types (e.g.from children and adolesent database, group sessions, assessment types with very little cases) and assessment names (e.g. kodap pre)</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>glob_th <span class="ot">&lt;-</span> glob_master <span class="sc">|&gt;</span> </span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(assessment_name <span class="sc">==</span> <span class="st">"Glob-Th Globalbeurteilung"</span> <span class="sc">&amp;</span> (assessment_type <span class="sc">==</span> <span class="st">"KZT1-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"KZT2-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"LZT1-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"LZT2-DUPost"</span>))</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>glob_th_wider <span class="ot">&lt;-</span> glob_th <span class="sc">|&gt;</span> </span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> case_nr, <span class="at">names_from =</span> <span class="fu">c</span>(item_no, assessment_type), <span class="at">values_from =</span> answerscale_value) <span class="sc">|&gt;</span> </span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"glob_th_satisfaction_KZT1-DUPost"</span> <span class="ot">=</span> <span class="st">"1_KZT1-DUPost"</span>, <span class="st">"glob_th_satisfaction_KZT2-DUPost"</span> <span class="ot">=</span> <span class="st">"1_KZT2-DUPost"</span>, <span class="st">"glob_th_satisfaction_LZT1-DUPost"</span> <span class="ot">=</span> <span class="st">"1_LZT1-DUPost"</span>, <span class="st">"glob_th_satisfaction_LZT2-DUPost"</span> <span class="ot">=</span> <span class="st">"1_LZT2-DUPost"</span>, <span class="st">"glob_th_benefit_KZT1-DUPost"</span> <span class="ot">=</span> <span class="st">"2_KZT1-DUPost"</span>, <span class="st">"glob_th_benefit_KZT2-DUPost"</span> <span class="ot">=</span> <span class="st">"2_KZT2-DUPost"</span>, <span class="st">"glob_th_benefit_LZT1-DUPost"</span> <span class="ot">=</span> <span class="st">"2_LZT1-DUPost"</span>, <span class="st">"glob_th_benefit_LZT2-DUPost"</span> <span class="ot">=</span> <span class="st">"2_LZT2-DUPost"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div></div>
</section>
</section>
<section id="plausibility-checks-of-assessment-time-points" class="level2">
<h2 class="anchored" data-anchor-id="plausibility-checks-of-assessment-time-points">Plausibility Checks of Assessment Time Points</h2>
<p>During the calculation of sum scores, it became apparent that in some cases identical assessment time points (e.g., LZT 2) were documented more than once. This results in implausible sum scores (e.g., values &gt; 27 for the PMH). This issue is not limited to the PMH, but occurs across multiple instruments (e.g., BDI, BSI, DASS, GAS), suggesting a dataset-wide problem rather than an instrument-specific one. The purpose of the following plausibility check is to identify cases in which multiple different assessment dates (assessment_date) exist within the same combination of case number (case_nr) and assessment type (assessment_type).</p>
<div class="cell-container"><div class="cell-decorator"><pre>In [11]:</pre></div><div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identification of cases with inconsistent assessment time points</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="co"># (multiple assessment_dates within the same case_nr × assessment_type)</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Collect instrument-specific datasets</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>instrument_dfs <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">pmh =</span> pmh_erw,</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">bdi =</span> bdi_erw,</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">bsi =</span> bsi_erw,</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">dass =</span> dass_erw,</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">gas_th =</span> gas_th,</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">gas_pt =</span> gas_pt,</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">cgi_i_pt =</span> patient_kodap_post,</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">cgi_i_th =</span> therapist_kodap_post)</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Extract inconsistent cases per instrument</span></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>inconsistent_cases <span class="ot">&lt;-</span> <span class="fu">imap_dfr</span>(instrument_dfs, <span class="sc">~</span> .x <span class="sc">|&gt;</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(case_nr, assessment_type) <span class="sc">|&gt;</span></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n_distinct</span>(assessment_date, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(case_nr, assessment_type, assessment_date) <span class="sc">|&gt;</span></span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">instrument =</span> .y)</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(case_nr, instrument, assessment_type, assessment_date)</span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Unique list of affected patients</span></span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>affected_cases <span class="ot">&lt;-</span> inconsistent_cases <span class="sc">|&gt;</span></span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(case_nr) <span class="sc">|&gt;</span></span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(case_nr)</span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Output</span></span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a>inconsistent_cases</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 74 × 4
      case_nr assessment_type                     assessment_date     instrument
        &lt;dbl&gt; &lt;chr&gt;                               &lt;dttm&gt;              &lt;chr&gt;     
 1 2074101265 Diagnostisches Interview ab 01.04.… 2017-06-23 00:00:00 bsi       
 2 2074101265 Diagnostisches Interview ab 01.04.… 2019-04-02 00:00:00 bsi       
 3 2074101350 DU-Prä                              2017-05-16 00:00:00 bdi       
 4 2074101350 DU-Prä                              2019-05-08 00:00:00 bdi       
 5 2074101350 DU-Prä                              2017-05-16 00:00:00 pmh       
 6 2074101350 DU-Prä                              2019-05-08 00:00:00 pmh       
 7 2074101433 KZT1-DU4                            2017-06-27 00:00:00 bdi       
 8 2074101433 KZT1-DU4                            2017-08-01 00:00:00 bdi       
 9 2074101433 KZT1-DU4                            2017-06-27 00:00:00 bsi       
10 2074101433 KZT1-DU4                            2017-08-01 00:00:00 bsi       
# ℹ 64 more rows</code></pre>
</div>
</div></div>
<p><strong>Results of the Plausibility Check</strong></p>
<p>At present, 12 patients (chiffres) are affected by this issue.</p>
<div class="cell-container"><div class="cell-decorator"><pre>In [12]:</pre></div><div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>affected_cases</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 1
      case_nr
        &lt;dbl&gt;
 1 2074101265
 2 2074101350
 3 2074101433
 4 2074101719
 5 2074102453
 6 2074103245
 7 2074104002
 8 2074105661
 9 2074107741
10 2074108277
11 2074109151
12 2074110626</code></pre>
</div>
</div></div>
<p><em>Possible Explanations</em></p>
<ul>
<li><p>An identical assessment time point was entered more than once.</p></li>
<li><p>An incorrect assessment type was assigned because another measurement is missing and an existing one was duplicated instead.</p></li>
<li><p>After a follow-up assessment (e.g., Kat6), a time point from an ongoing therapy (e.g., LZT 2) appears again, followed by another follow-up assessment. This may indicate that a therapy was terminated and later resumed, while continuing under the same case number.</p></li>
<li><p>A pre-treatment assessment (Du-Prä) was conducted without subsequent therapy; several years later, the same patient re-entered treatment and was registered under the same case number, including a new pre-treatment assessment and follow-up measurements.</p></li>
</ul>
<p><em>Further Procedure</em></p>
<p>Determine which of the affected patient chiffres are included in the final dataset containing text data. For these cases, conduct a manual review of the original records to decide which assessment should be considered the “correct” one for analysis (likely requiring case-by-case decisions based on chronological order and documentation).</p>
</section>
<section id="prepare-text-data" class="level2">
<h2 class="anchored" data-anchor-id="prepare-text-data">prepare text data</h2>
<div class="cell-container"><div class="cell-decorator"><pre>In [13]:</pre></div><div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>transcription_hattingen_2017_2018_2019_corrected <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"/Volumes/meta_data/processed/processed_transcriptions/corrected/transcription_hattingen_2017_2018_2019_corrected.csv"</span>,</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">delim =</span> <span class="st">","</span>,</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">"path_audiofile"</span>,<span class="st">"patient_chiffre"</span>,<span class="st">"txt1_problem_development"</span>,<span class="st">"txt2_extra_stressors"</span>,<span class="st">"txt3_pre_onset_changes"</span>,<span class="st">"txt4_event_connection"</span>,<span class="st">"txt5_physical_symptoms"</span>,<span class="st">"txt6_problem_causes"</span>,<span class="st">"txt7_expected_improvements"</span>,<span class="st">"txt8_environment_response"</span>,<span class="st">"txt9_no_change_requested"</span>, <span class="st">"txt10_problem_description"</span>,<span class="st">"txt11_impacted_life_areas"</span>,<span class="st">"txt12_therapy_goals"</span>),</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">skip =</span> <span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 336 Columns: 14
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (14): path_audiofile, patient_chiffre, txt1_problem_development, txt2_ex...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>transcription_hattingen_2020_2021_corrected <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"/Volumes/meta_data/processed/processed_transcriptions/corrected/transcription_hattingen_2020_2021_corrected.csv"</span>,</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">delim =</span> <span class="st">";"</span>,</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">"path_audiofile"</span>,<span class="st">"patient_chiffre"</span>,<span class="st">"txt1_problem_development"</span>,<span class="st">"txt2_extra_stressors"</span>,<span class="st">"txt3_pre_onset_changes"</span>,<span class="st">"txt4_event_connection"</span>,<span class="st">"txt5_physical_symptoms"</span>,<span class="st">"txt6_problem_causes"</span>,<span class="st">"txt7_expected_improvements"</span>,<span class="st">"txt8_environment_response"</span>,<span class="st">"txt9_no_change_requested"</span>, <span class="st">"txt10_problem_description"</span>,<span class="st">"txt11_impacted_life_areas"</span>,<span class="st">"txt12_therapy_goals"</span>),</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">skip =</span> <span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 155 Columns: 14
── Column specification ────────────────────────────────────────────────────────
Delimiter: ";"
chr (14): path_audiofile, patient_chiffre, txt1_problem_development, txt2_ex...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>transcription_hattingen_2022_corrected <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"/Volumes/meta_data/processed/processed_transcriptions/corrected/transcription_hattingen_2022_corrected.csv"</span>,</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">delim =</span> <span class="st">";"</span>,</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">"path_audiofile"</span>,<span class="st">"patient_chiffre"</span>,<span class="st">"txt1_problem_development"</span>,<span class="st">"txt2_extra_stressors"</span>,<span class="st">"txt3_pre_onset_changes"</span>,<span class="st">"txt4_event_connection"</span>,<span class="st">"txt5_physical_symptoms"</span>,<span class="st">"txt6_problem_causes"</span>,<span class="st">"txt7_expected_improvements"</span>,<span class="st">"txt8_environment_response"</span>,<span class="st">"txt9_no_change_requested"</span>, <span class="st">"txt10_problem_description"</span>,<span class="st">"txt11_impacted_life_areas"</span>,<span class="st">"txt12_therapy_goals"</span>),</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">skip =</span> <span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 88 Columns: 14
── Column specification ────────────────────────────────────────────────────────
Delimiter: ";"
chr (14): path_audiofile, patient_chiffre, txt1_problem_development, txt2_ex...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>transcription_hattingen_2023_corrected <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"/Volumes/meta_data/processed/processed_transcriptions/corrected/transcription_hattingen_2023_corrected.csv"</span>,</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">delim =</span> <span class="st">","</span>,</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">"path_audiofile"</span>,<span class="st">"patient_chiffre"</span>,<span class="st">"txt1_problem_development"</span>,<span class="st">"txt2_extra_stressors"</span>,<span class="st">"txt3_pre_onset_changes"</span>,<span class="st">"txt4_event_connection"</span>,<span class="st">"txt5_physical_symptoms"</span>,<span class="st">"txt6_problem_causes"</span>,<span class="st">"txt7_expected_improvements"</span>,<span class="st">"txt8_environment_response"</span>,<span class="st">"txt9_no_change_requested"</span>, <span class="st">"txt10_problem_description"</span>,<span class="st">"txt11_impacted_life_areas"</span>,<span class="st">"txt12_therapy_goals"</span>),</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">skip =</span> <span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 98 Columns: 14
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (14): path_audiofile, patient_chiffre, txt1_problem_development, txt2_ex...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>transcription_bochum_alt_corrected <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"/Volumes/meta_data/processed/processed_transcriptions/corrected/transcription_bochum_alt_corrected.csv"</span>,</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">delim =</span> <span class="st">","</span>,</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">"path_audiofile"</span>,<span class="st">"patient_chiffre"</span>,<span class="st">"txt1_problem_development"</span>,<span class="st">"txt2_extra_stressors"</span>,<span class="st">"txt3_pre_onset_changes"</span>,<span class="st">"txt4_event_connection"</span>,<span class="st">"txt5_physical_symptoms"</span>,<span class="st">"txt6_problem_causes"</span>,<span class="st">"txt7_expected_improvements"</span>,<span class="st">"txt8_environment_response"</span>,<span class="st">"txt9_no_change_requested"</span>, <span class="st">"txt10_problem_description"</span>,<span class="st">"txt11_impacted_life_areas"</span>,<span class="st">"txt12_therapy_goals"</span>),</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">skip =</span> <span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 220 Columns: 14
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (14): path_audiofile, patient_chiffre, txt1_problem_development, txt2_ex...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>merged_text_raw <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(transcription_hattingen_2017_2018_2019_corrected, transcription_hattingen_2020_2021_corrected, transcription_hattingen_2022_corrected, transcription_hattingen_2023_corrected, transcription_bochum_alt_corrected)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>merged_text <span class="ot">&lt;-</span> merged_text_raw <span class="sc">|&gt;</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="co"># extract treatment_center, year of the treatment end from audiofile path</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">treatment_center       =</span> <span class="fu">str_match</span>(path_audiofile, <span class="st">"raw_audio/([^/]+)/"</span>)[, <span class="dv">2</span>],</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">treatment_end_year_text =</span> <span class="fu">str_match</span>(path_audiofile, <span class="st">"raw_audio/[^/]+/(</span><span class="sc">\\</span><span class="st">d{4})"</span>)[, <span class="dv">2</span>],</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">folder                 =</span> <span class="fu">dirname</span>(path_audiofile),</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">zoom_nr                =</span> <span class="fu">str_extract</span>(path_audiofile, <span class="st">"(?&lt;=ZOOM)</span><span class="sc">\\</span><span class="st">d+"</span>),</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">zoom_nr                =</span> <span class="fu">as.integer</span>(zoom_nr)</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(patient_chiffre, folder) <span class="sc">|&gt;</span></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(zoom_nr, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> <span class="co"># remove the older zoom_nr for each group of patient and folder</span></span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>    patient_chiffre,</span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>    treatment_center,</span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>    treatment_end_year_text,</span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a>    txt1_problem_development,</span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a>    txt2_extra_stressors,</span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a>    txt3_pre_onset_changes,</span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a>    txt4_event_connection,</span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a>    txt5_physical_symptoms,</span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true" tabindex="-1"></a>    txt6_problem_causes,</span>
<span id="cb71-24"><a href="#cb71-24" aria-hidden="true" tabindex="-1"></a>    txt7_expected_improvements,</span>
<span id="cb71-25"><a href="#cb71-25" aria-hidden="true" tabindex="-1"></a>    txt8_environment_response,</span>
<span id="cb71-26"><a href="#cb71-26" aria-hidden="true" tabindex="-1"></a>    txt9_no_change_requested,</span>
<span id="cb71-27"><a href="#cb71-27" aria-hidden="true" tabindex="-1"></a>    txt10_problem_description,</span>
<span id="cb71-28"><a href="#cb71-28" aria-hidden="true" tabindex="-1"></a>    txt11_impacted_life_areas,</span>
<span id="cb71-29"><a href="#cb71-29" aria-hidden="true" tabindex="-1"></a>    txt12_therapy_goals</span>
<span id="cb71-30"><a href="#cb71-30" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb71-31"><a href="#cb71-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-32"><a href="#cb71-32" aria-hidden="true" tabindex="-1"></a>merged_text_clean <span class="ot">&lt;-</span> merged_text <span class="sc">|&gt;</span></span>
<span id="cb71-33"><a href="#cb71-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(</span>
<span id="cb71-34"><a href="#cb71-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.na</span>(patient_chiffre) <span class="sc">|</span></span>
<span id="cb71-35"><a href="#cb71-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">if_all</span>(<span class="fu">contains</span>(<span class="st">"txt"</span>), is.na)</span>
<span id="cb71-36"><a href="#cb71-36" aria-hidden="true" tabindex="-1"></a>  ))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div></div>
</section>
<section id="merge-text-and-self-rating-scales" class="level2">
<h2 class="anchored" data-anchor-id="merge-text-and-self-rating-scales">merge text and self-rating scales</h2>
<div class="cell-container"><div class="cell-decorator"><pre>In [14]:</pre></div><div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>df_merged_self_rating <span class="ot">&lt;-</span> dsmv_filtered_wider_labeled <span class="sc">|&gt;</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(patient_kodap_pre_demographics_wider, <span class="at">by =</span> <span class="st">"case_nr"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(therapist_kodap_pre_context_wider, <span class="at">by =</span> <span class="st">"case_nr"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(bdi_wider_complete, <span class="at">by =</span> <span class="st">"case_nr"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(bsi_wider, <span class="at">by =</span> <span class="st">"case_nr"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(dass_wider, <span class="at">by =</span> <span class="st">"case_nr"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(pmh_wider, <span class="at">by =</span> <span class="st">"case_nr"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(gas_wider, <span class="at">by =</span> <span class="st">"case_nr"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(glob_th_wider, <span class="at">by =</span> <span class="st">"case_nr"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(glob_pt_wider, <span class="at">by =</span> <span class="st">"case_nr"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(patient_cgi_improvement_wider, <span class="at">by =</span> <span class="st">"case_nr"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(therapist_cgi_improvement_wider, <span class="at">by =</span> <span class="st">"case_nr"</span>) </span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>df_merged <span class="ot">&lt;-</span> merged_text_clean <span class="sc">|&gt;</span></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(df_merged_self_rating, <span class="at">by =</span> <span class="st">"patient_chiffre"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(case_nr, patient_dateofbirth, patient_age_therapy_start, patient_sex, marital_status, in_relationship, general_education, vocational_qualification, work_ability_status, previous_psychotherapy, assessment_date_DI, icd10_code, CGI_severity, therapist_dateofbirth, therapist_age_therapy_start, therapist_sex, <span class="fu">everything</span>(), <span class="sc">-</span>patient_chiffre, <span class="sc">-</span>icd10_code) <span class="co">#remove chiffre and icd code for export</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in left_join(merged_text_clean, df_merged_self_rating, by = "patient_chiffre"): Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 2 of `x` matches multiple rows in `y`.
ℹ Row 521 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(df_merged, <span class="st">"/Volumes/meta_data/processed/working_data/merged_data.rds"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div></div>
</section>
</section>
     </main>
<!-- /main column -->  <script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>  </div> <!-- /content --> 
  
</body></html>