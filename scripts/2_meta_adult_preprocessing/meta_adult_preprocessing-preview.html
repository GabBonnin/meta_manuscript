<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
    <meta charset="utf-8">
    <meta name="generator" content="quarto-1.8.26">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

    <meta name="author" content="Gabriel Bonnin">

    <title>META preprocessing</title>
    <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      div.columns{display: flex; gap: min(4vw, 1.5em);}
      div.column{flex: auto; overflow-x: auto;}
      div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
      ul.task-list{list-style: none;}
      ul.task-list li input[type="checkbox"] {
        width: 0.8em;
        margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
        vertical-align: middle;
      }
      /* CSS for syntax highlighting */
      html { -webkit-text-size-adjust: 100%; }
      pre > code.sourceCode { white-space: pre; position: relative; }
      pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
      pre > code.sourceCode > span:empty { height: 1.2em; }
      .sourceCode { overflow: visible; }
      code.sourceCode > span { color: inherit; text-decoration: inherit; }
      div.sourceCode { margin: 1em 0; }
      pre.sourceCode { margin: 0; }
      @media screen {
      div.sourceCode { overflow: auto; }
      }
      @media print {
      pre > code.sourceCode { white-space: pre-wrap; }
      pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
      }
      pre.numberSource code
        { counter-reset: source-line 0; }
      pre.numberSource code > span
        { position: relative; left: -4em; counter-increment: source-line; }
      pre.numberSource code > span > a:first-child::before
        { content: counter(source-line);
          position: relative; left: -1em; text-align: right; vertical-align: baseline;
          border: none; display: inline-block;
          -webkit-touch-callout: none; -webkit-user-select: none;
          -khtml-user-select: none; -moz-user-select: none;
          -ms-user-select: none; user-select: none;
          padding: 0 4px; width: 4em;
        }
      pre.numberSource { margin-left: 3em;  padding-left: 4px; }
      div.sourceCode
        {   }
      @media screen {
      pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
      }
    </style>

    <style>
      body.hypothesis-enabled #quarto-embed-header {
        padding-right: 36px;
      }

      #quarto-embed-header {
        height: 3em;
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: solid 1px;
      }

      #quarto-embed-header h6 {
        font-size: 1.1em;
        padding-top: 0.6em;
        margin-left: 1em;
        margin-right: 1em;
        font-weight: 400;
      }

      #quarto-embed-header a.quarto-back-link,
      #quarto-embed-header a.quarto-download-embed {
        font-size: 0.8em;
        margin-top: 1em;
        margin-bottom: 1em;
        margin-left: 1em;
        margin-right: 1em;
      }

      .quarto-back-container {
        padding-left: 0.5em;
        display: flex;
      }

      .headroom {
          will-change: transform;
          transition: transform 200ms linear;
      }

      .headroom--pinned {
          transform: translateY(0%);
      }

      .headroom--unpinned {
          transform: translateY(-100%);
      }      
    </style>

    <script>
    window.document.addEventListener("DOMContentLoaded", function () {

      var header = window.document.querySelector("#quarto-embed-header");
      const titleBannerEl = window.document.querySelector("body > #title-block-header");
      if (titleBannerEl) {
        titleBannerEl.style.paddingTop = header.clientHeight + "px";
      }
      const contentEl = window.document.getElementById('quarto-content');
      for (const child of contentEl.children) {
        child.style.paddingTop = header.clientHeight + "px";
        child.style.marginTop = "1em";
      }

      // Use the article root if the `back` call doesn't work. This isn't perfect
      // but should typically work
      window.quartoBackToArticle = () => {
        var currentUrl = window.location.href;
        window.history.back();
        setTimeout(() => {
            // if location was not changed in 100 ms, then there is no history back
            if(currentUrl === window.location.href){              
                // redirect to site root
                window.location.href = "../../index.html";
            }
        }, 100);
      }

      const headroom = new window.Headroom(header, {
        tolerance: 5,
        onPin: function () {
        },
        onUnpin: function () {
        },
      });
      headroom.init();
    });
    </script>

    
<script src="../../site_libs/manuscript-notebook/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-a74871fe4945b66d259aafc266475145.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
     <script async="" src="https://hypothes.is/embed.js"></script>  
      </head>

  <body class="quarto-notebook quarto-light">
    <div id="quarto-embed-header" class="headroom fixed-top bg-primary">
      
      <a onclick="window.quartoBackToArticle(); return false;" class="btn btn-primary quarto-back-link" href=""><i class="bi bi-caret-left"></i> Back to Article</a>
      <h6><i class="bi bi-journal-code"></i> META preprocessing</h6>

            <a href="../../scripts/2_meta_adult_preprocessing/meta_adult_preprocessing.qmd" class="btn btn-primary quarto-download-embed" download="meta_adult_preprocessing.qmd">Download Source</a>
          </div>

     <header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">META preprocessing</h1>
          </div>

    
    <div class="quarto-title-meta-container">
      <div class="quarto-title-meta-column-start">
        
        <div class="quarto-title-meta">

                <div>
            <div class="quarto-title-meta-heading">Author</div>
            <div class="quarto-title-meta-contents">
                        <p>Gabriel Bonnin </p>
                      </div>
          </div>
                
          
                
              </div>
      </div>
      <div class="quarto-title-meta-column-end quarto-other-formats-target">
      </div>
    </div>



    <div class="quarto-other-links-text-target">
    </div>  </div>
</header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#preprocessing" id="toc-preprocessing" class="nav-link active" data-scroll-target="#preprocessing">Preprocessing</a>
  <ul class="collapse">
  <li><a href="#prepare-self-report-rating-scales-from-the-outpatient-clinic" id="toc-prepare-self-report-rating-scales-from-the-outpatient-clinic" class="nav-link" data-scroll-target="#prepare-self-report-rating-scales-from-the-outpatient-clinic">prepare self-report rating scales from the outpatient clinic</a>
  <ul class="collapse">
  <li><a href="#demographics-and-context-factors" id="toc-demographics-and-context-factors" class="nav-link" data-scroll-target="#demographics-and-context-factors">Demographics and context factors</a></li>
  <li><a href="#cgi-improvement-scale" id="toc-cgi-improvement-scale" class="nav-link" data-scroll-target="#cgi-improvement-scale">CGI Improvement Scale</a></li>
  <li><a href="#diagnosis" id="toc-diagnosis" class="nav-link" data-scroll-target="#diagnosis">Diagnosis</a></li>
  <li><a href="#bdi-ii" id="toc-bdi-ii" class="nav-link" data-scroll-target="#bdi-ii">BDI II</a></li>
  <li><a href="#bsi" id="toc-bsi" class="nav-link" data-scroll-target="#bsi">BSI</a></li>
  <li><a href="#dass-42" id="toc-dass-42" class="nav-link" data-scroll-target="#dass-42">DASS-42</a></li>
  <li><a href="#gas" id="toc-gas" class="nav-link" data-scroll-target="#gas">GAS</a></li>
  <li><a href="#pmh" id="toc-pmh" class="nav-link" data-scroll-target="#pmh">PMH</a></li>
  <li><a href="#global-improvement" id="toc-global-improvement" class="nav-link" data-scroll-target="#global-improvement">Global Improvement</a></li>
  </ul></li>
  <li><a href="#prepare-text-data" id="toc-prepare-text-data" class="nav-link" data-scroll-target="#prepare-text-data">prepare text data</a></li>
  <li><a href="#merge-text-and-self-rating-scales" id="toc-merge-text-and-self-rating-scales" class="nav-link" data-scroll-target="#merge-text-and-self-rating-scales">merge text and self-rating scales</a></li>
  <li><a href="#plausibility-checks-of-assessment-time-points" id="toc-plausibility-checks-of-assessment-time-points" class="nav-link" data-scroll-target="#plausibility-checks-of-assessment-time-points">Plausibility Checks of Assessment Time Points</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">      

       <section id="preprocessing" class="level1">
<h1>Preprocessing</h1>
<section id="prepare-self-report-rating-scales-from-the-outpatient-clinic" class="level2">
<h2 class="anchored" data-anchor-id="prepare-self-report-rating-scales-from-the-outpatient-clinic">prepare self-report rating scales from the outpatient clinic</h2>
<div class="cell-container"><div class="cell-decorator"><pre>In [1]:</pre></div><div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.1     ✔ stringr   1.5.1
✔ ggplot2   3.5.2     ✔ tibble    3.3.0
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.1.0     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the dataframe containing cases in which assessment_types were accidentally assessed or imported multiple times, resulting in list-columns in the merged dataframe. For the time being, these cases will be removed from the dataset to ensure clean downstream analyses. Prior to finalizing the dataset, I will review these cases individually and determine which assessment types should be retained (see ## Plausibility Checks of Assessment Time Points).</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>affected_cases <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"/Volumes/meta_data/processed/working_data/affected_cases.rds"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div></div>
<section id="demographics-and-context-factors" class="level3">
<h3 class="anchored" data-anchor-id="demographics-and-context-factors">Demographics and context factors</h3>
<div class="cell-container"><div class="cell-decorator"><pre>In [2]:</pre></div><div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>patient_kodap <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"/Volumes/meta_data/raw/raw_selfreport/Patient_KODAP_ab2017.xlsx"</span>,</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">"case_nr"</span>, <span class="st">"patient_chiffre"</span>,<span class="st">"patient_sex"</span>,<span class="st">"patient_dateofbirth"</span>,<span class="st">"assessment_date"</span>,<span class="st">"assessment_type"</span>,<span class="st">"assessment_id"</span>,<span class="st">"assessment_name"</span>,<span class="st">"item_no"</span>,<span class="st">"answerscale_value"</span>,<span class="st">"freecomment"</span>,<span class="st">"therapist_no"</span>,<span class="st">"therapist_sex"</span>,<span class="st">"therapist_dateofbirth"</span>),</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">skip =</span> <span class="dv">1</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">#exclude "affected cases" with erroneous assessment_types.</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>patient_kodap <span class="ot">&lt;-</span> patient_kodap <span class="sc">%&gt;%</span> </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>case_nr <span class="sc">%in%</span> affected_cases<span class="sc">$</span>case_nr)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>therapist_kodap <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"/Volumes/meta_data/raw/raw_selfreport/Therapeuten_KODAP_ab2017.xlsx"</span>,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">"case_nr"</span>, <span class="st">"patient_chiffre"</span>,<span class="st">"patient_sex"</span>,<span class="st">"patient_dateofbirth"</span>,<span class="st">"assessment_date"</span>,<span class="st">"assessment_type"</span>,<span class="st">"assessment_id"</span>,<span class="st">"assessment_name"</span>,<span class="st">"item_no"</span>,<span class="st">"answerscale_value"</span>,<span class="st">"freecomment"</span>,<span class="st">"therapist_no"</span>,<span class="st">"therapist_sex"</span>,<span class="st">"therapist_dateofbirth"</span>),</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>                        <span class="at">skip =</span> <span class="dv">1</span>)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co">#exclude "affected cases" with erroneous assessment_types.</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>therapist_kodap <span class="ot">&lt;-</span> therapist_kodap <span class="sc">%&gt;%</span> </span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>case_nr <span class="sc">%in%</span> affected_cases<span class="sc">$</span>case_nr)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co"># show different assessment names (e.g. pre and post assesments)</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(patient_kodap<span class="sc">$</span>assessment_name)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Patientenfragebogen KODAP_Post" "Patientenfragebogen KODAP_Pre" </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># show different assessment types (e.g. standardised assessment time points)</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(patient_kodap<span class="sc">$</span>assessment_type)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "LZT1-DUPost"                                 
 [2] "DU-Kat6"                                     
 [3] "DU-Kat12"                                    
 [4] "Diagnostisches Interview ab 01.04.2017"      
 [5] "KZT1-DUPost"                                 
 [6] "KZT2-DUPost"                                 
 [7] "DU-Kat24"                                    
 [8] "KiJu_Du_prä"                                 
 [9] "LZT2-DUPost"                                 
[10] "Du-Kat6 ohne Abrechnung"                     
[11] "Du-Kat24 ohne Abrechnung"                    
[12] "DU-Prä"                                      
[13] "LZT-DU40"                                    
[14] "Du-Kat12 ohne Abrechnung"                    
[15] "Du-Post(außerplanmäßig)"                     
[16] "KiJu-Kat24"                                  
[17] "Sprechstunde2"                               
[18] "KiJu-Kat6"                                   
[19] "Diagnostisches Interview ab 01.04.2017-Video"
[20] "KiJu-Kat6-ohne Abrechnung"                   
[21] "Du-Post-KZT1"                                
[22] "KiJu-Kat12"                                  
[23] "Minidips-Kat24"                              
[24] "KiJu-KZT2-DuPost"                            
[25] "Minidips-Kat12"                              
[26] "KiJu-LZT1-DuPost"                            
[27] "Erstgespräch (probatorisch)"                 
[28] "Sprechstunde3"                               </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#how many patients are there for each assessment type?</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>patient_kodap <span class="sc">|&gt;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_patienten =</span> <span class="fu">n_distinct</span>(case_nr),</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> assessment_type</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n_patienten))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 28 × 2
   assessment_type                        n_patienten
   &lt;chr&gt;                                        &lt;int&gt;
 1 KZT1-DUPost                                   1877
 2 Diagnostisches Interview ab 01.04.2017        1752
 3 KZT2-DUPost                                   1471
 4 DU-Kat6                                        835
 5 LZT1-DUPost                                    750
 6 DU-Kat12                                       678
 7 DU-Kat24                                       553
 8 LZT2-DUPost                                    199
 9 Du-Kat24 ohne Abrechnung                       145
10 KiJu-Kat24                                     137
# ℹ 18 more rows</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#remove non-relevant assessment types (e.g.from children and adolesent database, group sessions, assessment types with very little cases) and assessment names (e.g. kodap post)</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>patient_kodap_pre_demographics <span class="ot">&lt;-</span> patient_kodap <span class="sc">|&gt;</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(assessment_name <span class="sc">==</span> <span class="st">"Patientenfragebogen KODAP_Pre"</span> <span class="sc">&amp;</span> assessment_type <span class="sc">==</span> <span class="st">"Diagnostisches Interview ab 01.04.2017"</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># pivot wider</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>patient_kodap_pre_demographics_wider <span class="ot">&lt;-</span> patient_kodap_pre_demographics <span class="sc">|&gt;</span> </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(item_no <span class="sc">!=</span> <span class="dv">1</span> <span class="sc">&amp;</span> item_no<span class="sc">!=</span> <span class="dv">2</span>) <span class="sc">|&gt;</span>  <span class="co">#remove irrelevant items (1 = date of birth, 2 = sex)</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> case_nr, <span class="at">names_from =</span> item_no, <span class="at">values_from =</span> answerscale_value) <span class="sc">|&gt;</span> <span class="co"># remove patient_chiffre and other redundant variables (date of birth, sex, etc.) for merging with other self-rating df's </span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">marital_status =</span> <span class="st">"3"</span>, <span class="at">in_relationship =</span> <span class="st">"4"</span>, <span class="at">general_education =</span> <span class="st">"5"</span>, <span class="at">vocational_qualification =</span> <span class="st">"6"</span>, <span class="at">work_ability_status =</span> <span class="st">"7"</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co"># transform to factors with labels</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co"># set labels</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>marital_status_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"0"</span> <span class="ot">=</span> <span class="st">"single"</span>, <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"married"</span>, <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"divorced"</span>, <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"seperated"</span>, <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"widowed"</span>, <span class="st">"5"</span> <span class="ot">=</span> <span class="st">"other"</span>)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>relationship_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"0"</span> <span class="ot">=</span> <span class="st">"yes"</span>, <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"no"</span>)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>general_education_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"0"</span> <span class="ot">=</span> <span class="st">"student"</span>, <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"no school-leaving certificate"</span>, <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"lower secondary school certificate"</span>, <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"intermediate secondary school certificate"</span>, <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"higher education entrance qualification"</span>, <span class="st">"5"</span> <span class="ot">=</span> <span class="st">"other"</span>) </span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>vocational_qualification_labels  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"0"</span> <span class="ot">=</span> <span class="st">"Currently in vocational training or studying"</span>, <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"No vocational qualification"</span>, <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"Apprenticeship / vocational training"</span>, <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"University or university of applied sciences degree"</span>, <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"Other"</span>) </span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>work_ability_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"0"</span> <span class="ot">=</span> <span class="st">"Able to work"</span>, <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"Unable to work (on sick leave)"</span>, <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"Disability pension"</span>, <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"Old-age pension"</span>, <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"Other"</span>) </span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="co"># transform to factor and add labels</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>patient_kodap_pre_demographics_wider<span class="sc">$</span>marital_status <span class="ot">&lt;-</span> <span class="fu">factor</span>(patient_kodap_pre_demographics_wider<span class="sc">$</span>marital_status, <span class="at">levels =</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(marital_status_labels)), <span class="at">labels =</span> marital_status_labels)</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>patient_kodap_pre_demographics_wider<span class="sc">$</span>in_relationship <span class="ot">&lt;-</span> <span class="fu">factor</span>(patient_kodap_pre_demographics_wider<span class="sc">$</span>in_relationship, <span class="at">levels =</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(relationship_labels)), <span class="at">labels =</span> relationship_labels)</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>patient_kodap_pre_demographics_wider<span class="sc">$</span>general_education <span class="ot">&lt;-</span> <span class="fu">factor</span>(patient_kodap_pre_demographics_wider<span class="sc">$</span>general_education, <span class="at">levels =</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(general_education_labels)), <span class="at">labels =</span> general_education_labels)</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>patient_kodap_pre_demographics_wider<span class="sc">$</span>vocational_qualification <span class="ot">&lt;-</span> <span class="fu">factor</span>(patient_kodap_pre_demographics_wider<span class="sc">$</span>vocational_qualification, <span class="at">levels =</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(vocational_qualification_labels)), <span class="at">labels =</span> vocational_qualification_labels)</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>patient_kodap_pre_demographics_wider<span class="sc">$</span>work_ability_status <span class="ot">&lt;-</span> <span class="fu">factor</span>(patient_kodap_pre_demographics_wider<span class="sc">$</span>work_ability_status, <span class="at">levels =</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(work_ability_labels)), <span class="at">labels =</span> work_ability_labels)</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a><span class="co"># show different assessment names (e.g. pre and post assesments)</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(therapist_kodap<span class="sc">$</span>assessment_name)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Therapeutenfragebogen KODAP_Pre"  "Therapeutenfragebogen_KODAP_Post"
[3] "Therapeutenfragebogen_KODAP_Kat" </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># show different assessment types (e.g. standardised assessment time points)</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(therapist_kodap<span class="sc">$</span>assessment_type)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Diagnostisches Interview ab 01.04.2017"      
 [2] "KZT1-DUPost"                                 
 [3] "KZT2-DUPost"                                 
 [4] "Minidips-Kat6"                               
 [5] "LZT1-DUPost"                                 
 [6] "Diagnostisches Interview"                    
 [7] "Minidips-Kat6-Video"                         
 [8] "Minidips-Kat24-Video"                        
 [9] "Minidips-Kat12"                              
[10] "Minidips-Kat12-Video"                        
[11] "Minidips-Kat24"                              
[12] "Minidips-Kat24-telefonisch"                  
[13] "DU-Prä"                                      
[14] "Minidips-Kat12-telefonisch"                  
[15] "LZT2-DUPost"                                 
[16] "Du-Post(außerplanmäßig)"                     
[17] "Diagnostisches Interview ab 01.04.2017-Video"
[18] "Sprechstunde2"                               
[19] "Minidips-Kat6-telefonisch"                   
[20] "Probatorische Einzeltherapiesitzung-Video"   
[21] "Persönlicher Kurzkontakt-Video"              
[22] "Sprechstunde-Video"                          
[23] "Persönlicher Kurzkontakt"                    
[24] "Du-Post-KZT1"                                
[25] "KiJu-LZT1-DuPost"                            
[26] "Erstgespräch (probatorisch)"                 
[27] "Sprechstunde3"                               
[28] "probatorische Einzeltherapiesitzung"         </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#how many patients are there for each assessment type?</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>therapist_kodap <span class="sc">|&gt;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_patienten =</span> <span class="fu">n_distinct</span>(case_nr),</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> assessment_type</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n_patienten))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 28 × 2
   assessment_type                        n_patienten
   &lt;chr&gt;                                        &lt;int&gt;
 1 Diagnostisches Interview ab 01.04.2017        2727
 2 KZT1-DUPost                                   1546
 3 KZT2-DUPost                                   1107
 4 LZT1-DUPost                                    530
 5 Minidips-Kat6                                  150
 6 Minidips-Kat12                                 136
 7 LZT2-DUPost                                    126
 8 Minidips-Kat24                                 110
 9 DU-Prä                                          82
10 Minidips-Kat24-Video                            47
# ℹ 18 more rows</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#remove non-relevant assessment types (e.g.from children and adolesent database, group sessions, assessment types with very little cases) and assessment names (e.g. kodap post)</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>therapist_kodap_pre_context <span class="ot">&lt;-</span> therapist_kodap <span class="sc">|&gt;</span> </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(assessment_name <span class="sc">==</span> <span class="st">"Therapeutenfragebogen KODAP_Pre"</span> <span class="sc">&amp;</span> assessment_type <span class="sc">==</span> <span class="st">"Diagnostisches Interview ab 01.04.2017"</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># pivot wider</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>therapist_kodap_pre_context_wider <span class="ot">&lt;-</span> therapist_kodap_pre_context <span class="sc">|&gt;</span> </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(item_no <span class="sc">==</span> <span class="dv">5</span> <span class="sc">|</span> item_no <span class="sc">==</span> <span class="dv">6</span> <span class="sc">|</span> item_no <span class="sc">==</span> <span class="dv">7</span> <span class="sc">|</span> item_no <span class="sc">==</span> <span class="dv">8</span>) <span class="sc">|&gt;</span>  <span class="co">#filter relevant items</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(case_nr), <span class="at">names_from =</span> item_no, <span class="at">values_from =</span> <span class="fu">c</span>(answerscale_value, freecomment)) <span class="sc">|&gt;</span>  <span class="co">#remove patient_chiffre and other redundant variables (date of birth, sex, etc.) for merging with other self-rating df's </span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(case_nr, answerscale_value_5, answerscale_value_8, freecomment_6) <span class="sc">|&gt;</span> <span class="co">#remove irrelevant variables</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">previous_psychotherapy =</span> <span class="st">"answerscale_value_5"</span>, <span class="at">icd10_code =</span> <span class="st">"freecomment_6"</span>, <span class="at">CGI_severity =</span> <span class="st">"answerscale_value_8"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Values from `answerscale_value` and `freecomment` are not uniquely identified;
output will contain list-cols.
• Use `values_fn = list` to suppress this warning.
• Use `values_fn = {summary_fun}` to summarise duplicates.
• Use the following dplyr code to identify duplicates.
  {data} |&gt;
  dplyr::summarise(n = dplyr::n(), .by = c(case_nr, item_no)) |&gt;
  dplyr::filter(n &gt; 1L)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># transform to factors with labels</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>previous_psychotherapy_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"0"</span> <span class="ot">=</span> <span class="st">"no prior treatment"</span>, <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"outpatient psychotherapy"</span>, <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"inpatient psychotherapy"</span>, <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"both"</span>, <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"exact specification not available"</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>CGI_severity_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"0"</span> <span class="ot">=</span> <span class="st">"Not assessable"</span>, <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"Normal, not at all ill"</span>, <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"Borderline mentally ill"</span>, <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"Mildly ill"</span>, <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"Moderately ill"</span>, <span class="st">"5"</span> <span class="ot">=</span> <span class="st">"Markedly ill"</span>, <span class="st">"6"</span> <span class="ot">=</span> <span class="st">"Severely ill"</span>, <span class="st">"7"</span> <span class="ot">=</span> <span class="st">"Among the most extremely ill patients"</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>therapist_kodap_pre_context_wider<span class="sc">$</span>previous_psychotherapy <span class="ot">&lt;-</span> <span class="fu">factor</span>(therapist_kodap_pre_context_wider<span class="sc">$</span>previous_psychotherapy, <span class="at">levels =</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(previous_psychotherapy_labels)), <span class="at">labels =</span> previous_psychotherapy_labels)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>therapist_kodap_pre_context_wider<span class="sc">$</span>CGI_severity <span class="ot">&lt;-</span> <span class="fu">factor</span>(therapist_kodap_pre_context_wider<span class="sc">$</span>CGI_severity, <span class="at">levels =</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(CGI_severity_labels)), <span class="at">labels =</span> CGI_severity_labels)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div></div>
</section>
<section id="cgi-improvement-scale" class="level3">
<h3 class="anchored" data-anchor-id="cgi-improvement-scale">CGI Improvement Scale</h3>
<div class="cell-container"><div class="cell-decorator"><pre>In [3]:</pre></div><div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#remove non-relevant assessment types (e.g.from children and adolesent database, group sessions, assessment types with very little cases) and assessment names (e.g. kodap pre)</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>patient_kodap_post <span class="ot">&lt;-</span> patient_kodap <span class="sc">|&gt;</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(assessment_name <span class="sc">==</span> <span class="st">"Patientenfragebogen KODAP_Post"</span> <span class="sc">&amp;</span> (assessment_type <span class="sc">==</span> <span class="st">"KZT1-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"KZT2-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"LZT1-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"LZT2-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"DU-Kat6"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"DU-Kat12"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"DU-Kat24"</span>))</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># pivot wider</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>patient_cgi_improvement_wider <span class="ot">&lt;-</span> patient_kodap_post <span class="sc">|&gt;</span> </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(item_no <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">|&gt;</span>  <span class="co">#filter relevant items</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> case_nr, <span class="at">names_from =</span> <span class="fu">c</span>(item_no, assessment_type), <span class="at">values_from =</span> answerscale_value) <span class="sc">|&gt;</span> </span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"cgi_improvement_patient_KZT1-DUPost"</span> <span class="ot">=</span> <span class="st">"2_KZT1-DUPost"</span>, <span class="st">"cgi_improvement_patient_KZT2-DUPost"</span> <span class="ot">=</span> <span class="st">"2_KZT2-DUPost"</span>, <span class="st">"cgi_improvement_patient_LZT1-DUPost"</span> <span class="ot">=</span> <span class="st">"2_LZT1-DUPost"</span>, <span class="st">"cgi_improvement_patient_LZT2-DUPost"</span> <span class="ot">=</span> <span class="st">"2_LZT2-DUPost"</span>, <span class="st">"cgi_improvement_patient_DU-Kat6"</span> <span class="ot">=</span> <span class="st">"2_DU-Kat6"</span>, <span class="st">"cgi_improvement_patient_DU-Kat12"</span> <span class="ot">=</span> <span class="st">"2_DU-Kat12"</span>, <span class="st">"cgi_improvement_patient_DU-Kat24"</span> <span class="ot">=</span> <span class="st">"2_DU-Kat24"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(case_nr, <span class="st">"cgi_improvement_patient_KZT1-DUPost"</span>, <span class="st">"cgi_improvement_patient_KZT2-DUPost"</span>, <span class="st">"cgi_improvement_patient_LZT1-DUPost"</span>, <span class="st">"cgi_improvement_patient_LZT2-DUPost"</span>, <span class="st">"cgi_improvement_patient_DU-Kat6"</span>, <span class="st">"cgi_improvement_patient_DU-Kat12"</span>, <span class="st">"cgi_improvement_patient_DU-Kat24"</span>)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>therapist_kodap_post <span class="ot">&lt;-</span> therapist_kodap <span class="sc">|&gt;</span> </span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(assessment_name <span class="sc">==</span> <span class="st">"Therapeutenfragebogen_KODAP_Post"</span> <span class="sc">&amp;</span> (assessment_type <span class="sc">==</span> <span class="st">"KZT1-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"KZT2-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"LZT1-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"LZT2-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"Minidips-Kat6"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"Minidips-Kat12"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"Minidips-Kat24"</span>)) </span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="co">#Therapeuten CGI Improvement macht in der Kat keinen Sinn, da hier i.d.R. andere Therapeuten das Rating vornehmen und damit keine relative Einschätzung der "Besserung" vorgenommen werden kann --&gt; Kats für CGI Improvement Therapeutenrating ausschließen</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="co"># pivot wider</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>therapist_cgi_improvement_wider <span class="ot">&lt;-</span> therapist_kodap_post <span class="sc">|&gt;</span> </span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(item_no <span class="sc">==</span> <span class="dv">14</span>) <span class="sc">|&gt;</span>  <span class="co">#filter relevant items</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> case_nr, <span class="at">names_from =</span> <span class="fu">c</span>(item_no, assessment_type), <span class="at">values_from =</span> answerscale_value)  <span class="sc">|&gt;</span> </span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"cgi_improvement_therapist_KZT1-DUPost"</span> <span class="ot">=</span> <span class="st">"14_KZT1-DUPost"</span>, <span class="st">"cgi_improvement_therapist_KZT2-DUPost"</span> <span class="ot">=</span> <span class="st">"14_KZT2-DUPost"</span>, <span class="st">"cgi_improvement_therapist_LZT1-DUPost"</span> <span class="ot">=</span> <span class="st">"14_LZT1-DUPost"</span>, <span class="st">"cgi_improvement_therapist_LZT2-DUPost"</span> <span class="ot">=</span> <span class="st">"14_LZT2-DUPost"</span>, <span class="st">"cgi_improvement_therapist_DU-Kat6"</span> <span class="ot">=</span> <span class="st">"14_Minidips-Kat6"</span>, <span class="st">"cgi_improvement_therapist_DU-Kat12"</span> <span class="ot">=</span> <span class="st">"14_Minidips-Kat12"</span>, <span class="st">"cgi_improvement_therapist_DU-Kat24"</span> <span class="ot">=</span> <span class="st">"14_Minidips-Kat24"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(case_nr, <span class="st">"cgi_improvement_therapist_KZT1-DUPost"</span>, <span class="st">"cgi_improvement_therapist_KZT2-DUPost"</span>, <span class="st">"cgi_improvement_therapist_LZT1-DUPost"</span>, <span class="st">"cgi_improvement_therapist_LZT2-DUPost"</span>, <span class="st">"cgi_improvement_therapist_DU-Kat6"</span>, <span class="st">"cgi_improvement_therapist_DU-Kat12"</span>, <span class="st">"cgi_improvement_therapist_DU-Kat24"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div></div>
</section>
<section id="diagnosis" class="level3">
<h3 class="anchored" data-anchor-id="diagnosis">Diagnosis</h3>
<div class="cell-container"><div class="cell-decorator"><pre>In [4]:</pre></div><div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>dsmv_master <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"/Volumes/meta_data/raw/raw_selfreport/DSM_V_ab2017.xlsx"</span>,</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">"case_nr"</span>, <span class="st">"patient_chiffre"</span>,<span class="st">"patient_sex"</span>,<span class="st">"patient_dateofbirth"</span>,<span class="st">"assessment_date"</span>,<span class="st">"assessment_type"</span>,<span class="st">"assessment_id"</span>,<span class="st">"assessment_name"</span>,<span class="st">"item_no"</span>,<span class="st">"treenodepath"</span>,<span class="st">"answerscale_value"</span>,<span class="st">"therapist_no"</span>,<span class="st">"therapist_sex"</span>,<span class="st">"therapist_dateofbirth"</span>),</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">skip =</span> <span class="dv">1</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co">#exclude "affected cases" with erroneous assessment_types.</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>dsmv_master <span class="ot">&lt;-</span> dsmv_master <span class="sc">%&gt;%</span> </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>case_nr <span class="sc">%in%</span> affected_cases<span class="sc">$</span>case_nr)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co"># this table codes the answescale_value of item_no 5 to a dsm-v diagnosis</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>dsmv_codebook <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"/Volumes/meta_data/raw/raw_selfreport/DSMV_Diagno_inhalt_Code.xlsx"</span>,</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>                           <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">"scalevalue"</span>,<span class="st">"dsmv_diagnosis"</span>,<span class="st">"assessment_id"</span>),</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>                           <span class="at">skip =</span> <span class="dv">1</span>)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="co">#how many patients are there for each assessment type?</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>dsmv_master <span class="sc">|&gt;</span> </span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_patients =</span> <span class="fu">n_distinct</span>(case_nr),</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> assessment_type</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n_patients))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 102 × 2
   assessment_type                        n_patients
   &lt;chr&gt;                                       &lt;int&gt;
 1 Sprechstunde1                                8194
 2 KiJu-Sprechstunde1                           3496
 3 Diagnostisches Interview ab 01.04.2017       3162
 4 KZT1-DUPost                                  1737
 5 Eltern-DIPS(Eltern)                          1532
 6 KZT1-DU4                                     1275
 7 KZT2-DUPost                                  1227
 8 KiJu-Sprechstd.(Kinder-Dips2)                1095
 9 Minidips-Kat6                                 951
10 EG_KiJu_Krise                                 740
# ℹ 92 more rows</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#work with assessment_type "Diagnostisches Interview ab ..."</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co">#remove non-relevant assessment types (e.g.from children and adolesent database, assessment types with very little cases) and assessment names ()</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>dsmv_filtered <span class="ot">&lt;-</span> dsmv_master <span class="sc">|&gt;</span> </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(assessment_name <span class="sc">==</span> <span class="st">"DSM V"</span> <span class="sc">&amp;</span> assessment_type <span class="sc">==</span> <span class="st">"Diagnostisches Interview ab 01.04.2017"</span>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>dsmv_filtered_wider <span class="ot">&lt;-</span> dsmv_filtered <span class="sc">|&gt;</span> </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(case_nr, patient_chiffre, patient_dateofbirth, patient_sex, therapist_dateofbirth, therapist_sex, assessment_date), <span class="at">names_from =</span> item_no, <span class="at">values_from =</span> <span class="fu">c</span>(treenodepath, answerscale_value)) <span class="sc">|&gt;</span> </span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(answerscale_value_5, <span class="at">names_sep =</span> <span class="st">"_"</span>) <span class="sc">|&gt;</span> <span class="co">#split up list-columns for cases with comorbidity</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(answerscale_value_6, <span class="at">names_sep =</span> <span class="st">"_"</span>) <span class="sc">|&gt;</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(answerscale_value_7, <span class="at">names_sep =</span> <span class="st">"_"</span>) <span class="sc">|&gt;</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(answerscale_value_8, <span class="at">names_sep =</span> <span class="st">"_"</span>) <span class="sc">|&gt;</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(answerscale_value_9, <span class="at">names_sep =</span> <span class="st">"_"</span>) <span class="sc">|&gt;</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(answerscale_value_10, <span class="at">names_sep =</span> <span class="st">"_"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">assessment_date_DI =</span> <span class="st">"assessment_date"</span>, <span class="at">dsmv_diagnosis_1 =</span> <span class="st">"answerscale_value_5_1"</span>, <span class="at">dsmv_diagnosis_2 =</span> <span class="st">"answerscale_value_5_2"</span>,<span class="at">dsmv_diagnosis_3 =</span> <span class="st">"answerscale_value_5_3"</span>,<span class="at">dsmv_diagnosis_4 =</span> <span class="st">"answerscale_value_5_4"</span>,<span class="at">dsmv_diagnosis_5 =</span> <span class="st">"answerscale_value_5_5"</span>,<span class="at">dsmv_diagnosis_6 =</span> <span class="st">"answerscale_value_5_6"</span>,<span class="at">dsmv_diagnosis_7 =</span> <span class="st">"answerscale_value_5_7"</span>, <span class="at">dsmv_diagnosis_1_severity =</span> <span class="st">"answerscale_value_6_1"</span>, <span class="at">dsmv_diagnosis_2_severity =</span> <span class="st">"answerscale_value_6_2"</span>, <span class="at">dsmv_diagnosis_3_severity =</span> <span class="st">"answerscale_value_6_3"</span>, <span class="at">dsmv_diagnosis_4_severity =</span> <span class="st">"answerscale_value_6_4"</span>, <span class="at">dsmv_diagnosis_5_severity =</span> <span class="st">"answerscale_value_6_5"</span>, <span class="at">dsmv_diagnosis_6_severity =</span> <span class="st">"answerscale_value_6_6"</span>, <span class="at">dsmv_diagnosis_7_severity =</span> <span class="st">"answerscale_value_6_7"</span>, <span class="at">dsmv_diagnosis_1_confidence =</span> <span class="st">"answerscale_value_7_1"</span>, <span class="at">dsmv_diagnosis_2_confidence =</span> <span class="st">"answerscale_value_7_2"</span>, <span class="at">dsmv_diagnosis_3_confidence =</span> <span class="st">"answerscale_value_7_3"</span>, <span class="at">dsmv_diagnosis_4_confidence =</span> <span class="st">"answerscale_value_7_4"</span>, <span class="at">dsmv_diagnosis_5_confidence =</span> <span class="st">"answerscale_value_7_5"</span>, <span class="at">dsmv_diagnosis_6_confidence =</span> <span class="st">"answerscale_value_7_6"</span>, <span class="at">dsmv_diagnosis_7_confidence =</span> <span class="st">"answerscale_value_7_7"</span>, <span class="at">dsmv_diagnosis_1_type =</span> <span class="st">"answerscale_value_8_1"</span>, <span class="at">dsmv_diagnosis_2_type =</span> <span class="st">"answerscale_value_8_2"</span>, <span class="at">dsmv_diagnosis_3_type =</span> <span class="st">"answerscale_value_8_3"</span>, <span class="at">dsmv_diagnosis_4_type =</span> <span class="st">"answerscale_value_8_4"</span>, <span class="at">dsmv_diagnosis_5_type =</span> <span class="st">"answerscale_value_8_5"</span>, <span class="at">dsmv_diagnosis_6_type =</span> <span class="st">"answerscale_value_8_6"</span>, <span class="at">dsmv_diagnosis_7_type =</span> <span class="st">"answerscale_value_8_7"</span>, <span class="at">dsmv_diagnosis_1_reason_for_therapy =</span> <span class="st">"answerscale_value_9_1"</span>, <span class="at">dsmv_diagnosis_2_reason_for_therapy =</span> <span class="st">"answerscale_value_9_2"</span>, <span class="at">dsmv_diagnosis_3_reason_for_therapy =</span> <span class="st">"answerscale_value_9_3"</span>, <span class="at">dsmv_diagnosis_4_reason_for_therapy =</span> <span class="st">"answerscale_value_9_4"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(case_nr, patient_chiffre, patient_dateofbirth, patient_sex, therapist_dateofbirth, therapist_sex, assessment_date_DI, dsmv_diagnosis_1, dsmv_diagnosis_1_severity, dsmv_diagnosis_1_confidence, dsmv_diagnosis_1_type, dsmv_diagnosis_1_reason_for_therapy, dsmv_diagnosis_2, dsmv_diagnosis_2_severity, dsmv_diagnosis_2_confidence, dsmv_diagnosis_2_type, dsmv_diagnosis_2_reason_for_therapy, dsmv_diagnosis_3, dsmv_diagnosis_3_severity, dsmv_diagnosis_3_confidence, dsmv_diagnosis_3_type, dsmv_diagnosis_3_reason_for_therapy, dsmv_diagnosis_4, dsmv_diagnosis_4_severity, dsmv_diagnosis_4_confidence, dsmv_diagnosis_4_type, dsmv_diagnosis_4_reason_for_therapy, dsmv_diagnosis_5, dsmv_diagnosis_5_severity, dsmv_diagnosis_5_confidence, dsmv_diagnosis_5_type, dsmv_diagnosis_6, dsmv_diagnosis_6_severity, dsmv_diagnosis_6_confidence, dsmv_diagnosis_6_type, dsmv_diagnosis_7, dsmv_diagnosis_7_severity, dsmv_diagnosis_7_confidence, dsmv_diagnosis_7_type)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Values from `answerscale_value` and `treenodepath` are not uniquely identified;
output will contain list-cols.
• Use `values_fn = list` to suppress this warning.
• Use `values_fn = {summary_fun}` to summarise duplicates.
• Use the following dplyr code to identify duplicates.
  {data} |&gt;
  dplyr::summarise(n = dplyr::n(), .by = c(case_nr, patient_chiffre,
  patient_dateofbirth, patient_sex, therapist_dateofbirth, therapist_sex,
  assessment_date, item_no)) |&gt;
  dplyr::filter(n &gt; 1L)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># replace arbitrary numeric codes with diagnostic labels from the codebook</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># create lookup vector from codebook</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>lookup <span class="ot">&lt;-</span> <span class="fu">setNames</span>(dsmv_codebook<span class="sc">$</span>dsmv_diagnosis, dsmv_codebook<span class="sc">$</span>scalevalue)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># replace numeric codes with labels from lookup vector</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>dsmv_filtered_wider_labeled <span class="ot">&lt;-</span> dsmv_filtered_wider <span class="sc">|&gt;</span> </span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(dsmv_diagnosis_1, dsmv_diagnosis_2, dsmv_diagnosis_3, dsmv_diagnosis_4, dsmv_diagnosis_5, dsmv_diagnosis_6, dsmv_diagnosis_7),</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>                <span class="sc">~</span> lookup[<span class="fu">as.character</span>(.)]))</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="co"># transform to factors with labels</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="co">#patient_sex</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>dsmv_filtered_wider_labeled<span class="sc">$</span>patient_sex <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tolower</span>(dsmv_filtered_wider_labeled<span class="sc">$</span>patient_sex), <span class="co"># convert "M"→"m", "F"→"f"</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"m"</span>, <span class="st">"w"</span>),</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"male"</span>, <span class="st">"female"</span>)</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a><span class="co">#therapist_sex</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>dsmv_filtered_wider_labeled<span class="sc">$</span>therapist_sex <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tolower</span>(dsmv_filtered_wider_labeled<span class="sc">$</span>therapist_sex),</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"m"</span>, <span class="st">"w"</span>),</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"male"</span>, <span class="st">"female"</span>)</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a><span class="co"># set labels</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>dsmv_diagnosis_type_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"1"</span> <span class="ot">=</span> <span class="st">"primary diagnosis"</span>, <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"secondary diagnosis"</span>, <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"lifetime diagnosis"</span>)</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>dsmv_diagnosis_reason_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"1"</span> <span class="ot">=</span> <span class="st">"yes"</span>, <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"no"</span>)</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_1_type <span class="ot">&lt;-</span> <span class="fu">factor</span>(dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_1_type, <span class="at">levels =</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(dsmv_diagnosis_type_labels)), <span class="at">labels =</span> dsmv_diagnosis_type_labels)</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_2_type <span class="ot">&lt;-</span> <span class="fu">factor</span>(dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_2_type, <span class="at">levels =</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(dsmv_diagnosis_type_labels)), <span class="at">labels =</span> dsmv_diagnosis_type_labels)</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_3_type <span class="ot">&lt;-</span> <span class="fu">factor</span>(dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_3_type, <span class="at">levels =</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(dsmv_diagnosis_type_labels)), <span class="at">labels =</span> dsmv_diagnosis_type_labels)</span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_4_type <span class="ot">&lt;-</span> <span class="fu">factor</span>(dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_4_type, <span class="at">levels =</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(dsmv_diagnosis_type_labels)), <span class="at">labels =</span> dsmv_diagnosis_type_labels)</span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_5_type <span class="ot">&lt;-</span> <span class="fu">factor</span>(dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_5_type, <span class="at">levels =</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(dsmv_diagnosis_type_labels)), <span class="at">labels =</span> dsmv_diagnosis_type_labels)</span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_6_type <span class="ot">&lt;-</span> <span class="fu">factor</span>(dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_6_type, <span class="at">levels =</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(dsmv_diagnosis_type_labels)), <span class="at">labels =</span> dsmv_diagnosis_type_labels)</span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a>dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_7_type <span class="ot">&lt;-</span> <span class="fu">factor</span>(dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_7_type, <span class="at">levels =</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(dsmv_diagnosis_type_labels)), <span class="at">labels =</span> dsmv_diagnosis_type_labels)</span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a>dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_1_reason_for_therapy <span class="ot">&lt;-</span> <span class="fu">factor</span>(dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_1_reason_for_therapy, <span class="at">levels =</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(dsmv_diagnosis_reason_labels)), <span class="at">labels =</span> dsmv_diagnosis_reason_labels)</span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a>dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_2_reason_for_therapy <span class="ot">&lt;-</span> <span class="fu">factor</span>(dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_2_reason_for_therapy, <span class="at">levels =</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(dsmv_diagnosis_reason_labels)), <span class="at">labels =</span> dsmv_diagnosis_reason_labels)</span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a>dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_3_reason_for_therapy <span class="ot">&lt;-</span> <span class="fu">factor</span>(dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_3_reason_for_therapy, <span class="at">levels =</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(dsmv_diagnosis_reason_labels)), <span class="at">labels =</span> dsmv_diagnosis_reason_labels)</span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a>dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_4_reason_for_therapy <span class="ot">&lt;-</span> <span class="fu">factor</span>(dsmv_filtered_wider_labeled<span class="sc">$</span>dsmv_diagnosis_4_reason_for_therapy, <span class="at">levels =</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(dsmv_diagnosis_reason_labels)), <span class="at">labels =</span> dsmv_diagnosis_reason_labels)</span>
<span id="cb24-52"><a href="#cb24-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-53"><a href="#cb24-53" aria-hidden="true" tabindex="-1"></a><span class="co"># create variables patient_age_therapy_start and therapist_age_therapy_start</span></span>
<span id="cb24-54"><a href="#cb24-54" aria-hidden="true" tabindex="-1"></a>dsmv_filtered_wider_labeled <span class="ot">&lt;-</span> dsmv_filtered_wider_labeled <span class="sc">|&gt;</span></span>
<span id="cb24-55"><a href="#cb24-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb24-56"><a href="#cb24-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">patient_dateofbirth =</span> <span class="fu">as.Date</span>(patient_dateofbirth),</span>
<span id="cb24-57"><a href="#cb24-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">therapist_dateofbirth =</span> <span class="fu">as.Date</span>(therapist_dateofbirth),</span>
<span id="cb24-58"><a href="#cb24-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">assessment_date_DI =</span> <span class="fu">as.Date</span>(assessment_date_DI),</span>
<span id="cb24-59"><a href="#cb24-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">patient_age_therapy_start =</span> <span class="fu">floor</span>(<span class="fu">time_length</span>(<span class="fu">interval</span>(patient_dateofbirth, assessment_date_DI), <span class="st">"years"</span>)),</span>
<span id="cb24-60"><a href="#cb24-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">therapist_age_therapy_start =</span> <span class="fu">floor</span>(<span class="fu">time_length</span>(<span class="fu">interval</span>(therapist_dateofbirth, assessment_date_DI), <span class="st">"years"</span>))</span>
<span id="cb24-61"><a href="#cb24-61" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb24-62"><a href="#cb24-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(case_nr, patient_chiffre, patient_sex, patient_dateofbirth, patient_age_therapy_start, therapist_dateofbirth, therapist_age_therapy_start, <span class="fu">everything</span>())</span>
<span id="cb24-63"><a href="#cb24-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-64"><a href="#cb24-64" aria-hidden="true" tabindex="-1"></a><span class="co"># de-identify patient and therapist date of birth</span></span>
<span id="cb24-65"><a href="#cb24-65" aria-hidden="true" tabindex="-1"></a>dsmv_filtered_wider_labeled<span class="sc">$</span>patient_dateofbirth <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">format</span>(<span class="fu">as.Date</span>(dsmv_filtered_wider_labeled<span class="sc">$</span>patient_dateofbirth), <span class="st">"%Y"</span>))</span>
<span id="cb24-66"><a href="#cb24-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-67"><a href="#cb24-67" aria-hidden="true" tabindex="-1"></a>dsmv_filtered_wider_labeled<span class="sc">$</span>therapist_dateofbirth <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">format</span>(<span class="fu">as.Date</span>(dsmv_filtered_wider_labeled<span class="sc">$</span>therapist_dateofbirth), <span class="st">"%Y"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div></div>
</section>
<section id="bdi-ii" class="level3">
<h3 class="anchored" data-anchor-id="bdi-ii">BDI II</h3>
<div class="cell-container"><div class="cell-decorator"><pre>In [5]:</pre></div><div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>bdi_master <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"/Volumes/meta_data/raw/raw_selfreport/BDI II_ab2017.xlsx"</span>,</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">"case_nr"</span>, <span class="st">"patient_chiffre"</span>,<span class="st">"patient_sex"</span>,<span class="st">"patient_dateofbirth"</span>,<span class="st">"assessment_date"</span>,<span class="st">"assessment_type"</span>,<span class="st">"assessment_id"</span>,<span class="st">"assessment_name"</span>,<span class="st">"item_no"</span>,<span class="st">"answerscale_value"</span>,<span class="st">"therapist_no"</span>,<span class="st">"therapist_sex"</span>,<span class="st">"therapist_dateofbirth"</span>),</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">skip =</span> <span class="dv">1</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co">#exclude "affected cases" with erroneous assessment_types.</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>bdi_master <span class="ot">&lt;-</span> bdi_master <span class="sc">%&gt;%</span> </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>case_nr <span class="sc">%in%</span> affected_cases<span class="sc">$</span>case_nr)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co">#how many patients are there for each assessment type?</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>bdi_master <span class="sc">|&gt;</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_patients =</span> <span class="fu">n_distinct</span>(case_nr),</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> assessment_type</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n_patients))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 49 × 2
   assessment_type n_patients
   &lt;chr&gt;                &lt;int&gt;
 1 DU-Prä                3025
 2 KZT1-DUPost           2115
 3 KZT2-DUPost           1659
 4 KZT1-DU4              1427
 5 DU-Kat6               1028
 6 LZT1-DUPost            791
 7 LZT-DU40               463
 8 DU-Post                254
 9 LZT2-DUPost            200
10 DU30_Erwachsene        184
# ℹ 39 more rows</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#remove non-relevant assessment types (e.g.from children and adolesent database, group sessions, assessment types with very little cases) </span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>bdi_erw <span class="ot">&lt;-</span> bdi_master <span class="sc">|&gt;</span> </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(assessment_type, <span class="st">"KiJu|Krisen|DU-POST2|Gruppe|Einzeltherapiesitzung|Weitere|DU-4|DU-8|DU-12|DU-24|Erwachsene|Du-Post-KZT1|DU-Kat12|DU-Kat24|Interview|Abrechnung|außerplanmäßig|LZT-DU12|LZT-DU24|LZT-DU4|DU-Post"</span>))</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>bdi_erw <span class="sc">|&gt;</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(case_nr, assessment_type) <span class="sc">|&gt;</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n_distinct</span>(assessment_date, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(patient_chiffre, assessment_type, assessment_date) <span class="sc">|&gt;</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(patient_chiffre, assessment_type, assessment_date)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 3
# ℹ 3 variables: patient_chiffre &lt;chr&gt;, assessment_type &lt;chr&gt;,
#   assessment_date &lt;dttm&gt;</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if one single chiffre is related to several case_nrs? </span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>bdi_erw <span class="sc">|&gt;</span> </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_chiffre =</span> <span class="fu">n_distinct</span>(patient_chiffre), </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> case_nr) <span class="sc">|&gt;</span> </span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">anzahl =</span> <span class="fu">n</span>(), </span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">.by =</span> n_chiffre)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  n_chiffre anzahl
      &lt;int&gt;  &lt;int&gt;
1         1   3252</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if one single case_nr is related to several patient_chiffres.</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>bdi_erw <span class="sc">|&gt;</span> </span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_cases =</span> <span class="fu">n_distinct</span>(case_nr),</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> patient_chiffre) <span class="sc">|&gt;</span> </span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">anzahl =</span> <span class="fu">n</span>(),</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">.by =</span> n_cases)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  n_cases anzahl
    &lt;int&gt;  &lt;int&gt;
1       1   2923
2       2    154
3       3      7</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate BDI sum scores</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>bdi_erw_sum <span class="ot">&lt;-</span> bdi_erw <span class="sc">|&gt;</span> </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">patient_chiffre =</span> <span class="fu">first</span>(patient_chiffre),</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">patient_sex =</span> <span class="fu">first</span>(patient_sex),</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">patient_dateofbirth =</span> <span class="fu">first</span>(patient_dateofbirth),</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">bdi_sum =</span> <span class="fu">sum</span>(answerscale_value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">assessment_date =</span> <span class="fu">first</span>(assessment_date),</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">therapist_sex =</span> <span class="fu">first</span>(therapist_sex),</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">therapist_dateofbirth =</span> <span class="fu">first</span>(therapist_dateofbirth),</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> <span class="fu">c</span>(case_nr,assessment_type, assessment_date)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  )  <span class="sc">|&gt;</span> </span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(case_nr, patient_chiffre, patient_dateofbirth, patient_sex, assessment_type, bdi_sum, assessment_date, therapist_dateofbirth, therapist_sex)</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="co"># pivot df to have one case_nr in each row</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>bdi_wider <span class="ot">&lt;-</span> bdi_erw_sum <span class="sc">|&gt;</span> </span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(case_nr), <span class="at">names_from =</span> assessment_type, <span class="at">values_from =</span> <span class="fu">c</span>(bdi_sum, assessment_date)) <span class="sc">|&gt;</span>  <span class="co">#remove redundant variables (date of birth, sex, etc.) for merging with other self-rating df's </span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(case_nr, <span class="st">"bdi_sum_DU-Prä"</span>, <span class="st">"assessment_date_DU-Prä"</span>, <span class="st">"bdi_sum_KZT1-DU4"</span>, <span class="st">"assessment_date_KZT1-DU4"</span>, <span class="st">"bdi_sum_KZT1-DUPost"</span>, <span class="st">"assessment_date_KZT1-DUPost"</span>, <span class="st">"bdi_sum_KZT2-DUPost"</span>, <span class="st">"assessment_date_KZT2-DUPost"</span>, <span class="st">"bdi_sum_LZT1-DUPost"</span>, <span class="st">"assessment_date_LZT1-DUPost"</span>, <span class="st">"bdi_sum_LZT2-DUPost"</span>,<span class="st">"assessment_date_LZT2-DUPost"</span> ,<span class="st">"bdi_sum_DU-Kat6"</span>, <span class="st">"assessment_date_DU-Kat6"</span>)</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a><span class="co">#exclude cases without pre-measurement (most of the time cases where therapy startet before 2017)</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>bdi_wider_complete <span class="ot">&lt;-</span> bdi_wider <span class="sc">|&gt;</span></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="st">`</span><span class="at">bdi_sum_DU-Prä</span><span class="st">`</span>))</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a><span class="co">#how many cases are there in the dataset for each assessment type?</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>bdi_wider_complete <span class="sc">|&gt;</span> </span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"bdi_sum_"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span><span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(.))))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 7
  `bdi_sum_DU-Prä` `bdi_sum_KZT1-DU4` `bdi_sum_KZT1-DUPost`
             &lt;int&gt;              &lt;int&gt;                 &lt;int&gt;
1             3025               1418                  2079
# ℹ 4 more variables: `bdi_sum_KZT2-DUPost` &lt;int&gt;, `bdi_sum_LZT1-DUPost` &lt;int&gt;,
#   `bdi_sum_LZT2-DUPost` &lt;int&gt;, `bdi_sum_DU-Kat6` &lt;int&gt;</code></pre>
</div>
</div></div>
</section>
<section id="bsi" class="level3">
<h3 class="anchored" data-anchor-id="bsi">BSI</h3>
<div class="cell-container"><div class="cell-decorator"><pre>In [6]:</pre></div><div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>bsi_master <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"/Volumes/meta_data/raw/raw_selfreport/BSI_ab2017.xlsx"</span>, </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">"case_nr"</span>, <span class="st">"patient_chiffre"</span>, <span class="st">"patient_sex"</span>, <span class="st">"patient_dateofbirth"</span>, <span class="st">"assessment_date"</span>, <span class="st">"assessment_type"</span>, <span class="st">"assessment_id"</span>, <span class="st">"assessment_name"</span>, <span class="st">"item_no"</span>, <span class="st">"answerscale_value"</span>, <span class="st">"therapist_no"</span>, <span class="st">"therapist_sex"</span>, <span class="st">"therapist_dateofbirth"</span>), </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">skip =</span> <span class="dv">1</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co">#exclude "affected cases" with erroneous assessment_types.</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>bsi_master <span class="ot">&lt;-</span> bsi_master <span class="sc">%&gt;%</span> </span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>case_nr <span class="sc">%in%</span> affected_cases<span class="sc">$</span>case_nr)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co">#how many patients are there for each assessment type?</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>bsi_master <span class="sc">|&gt;</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_patients =</span> <span class="fu">n_distinct</span>(case_nr),</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> assessment_type</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n_patients))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 47 × 2
   assessment_type                        n_patients
   &lt;chr&gt;                                       &lt;int&gt;
 1 Diagnostisches Interview ab 01.04.2017       2230
 2 KZT1-DUPost                                  2123
 3 KZT2-DUPost                                  1654
 4 KZT1-DU4                                     1430
 5 DU-Kat6                                      1059
 6 DU-Kat12                                      849
 7 LZT1-DUPost                                   794
 8 DU-Kat24                                      673
 9 LZT-DU40                                      463
10 DU-Post                                       263
# ℹ 37 more rows</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">#remove non-relevant assessment types (e.g.from children and adolesent database, group sessions, assessment types with very little cases) </span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>bsi_erw <span class="ot">&lt;-</span> bsi_master <span class="sc">|&gt;</span> </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(assessment_type <span class="sc">==</span> <span class="st">"Diagnostisches Interview ab 01.04.2017"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"KZT1-DU4"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"KZT1-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"KZT2-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"LZT1-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"LZT2-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"DU-Kat6"</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>bsi_erw <span class="sc">|&gt;</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(case_nr, assessment_type) <span class="sc">|&gt;</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n_distinct</span>(assessment_date, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(patient_chiffre, assessment_type, assessment_date) <span class="sc">|&gt;</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(patient_chiffre, assessment_type, assessment_date)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 3
# ℹ 3 variables: patient_chiffre &lt;chr&gt;, assessment_type &lt;chr&gt;,
#   assessment_date &lt;dttm&gt;</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>bsi_erw_gsi <span class="ot">&lt;-</span> bsi_erw <span class="sc">|&gt;</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>item_no <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"54"</span>, <span class="st">"55"</span>, <span class="st">"11"</span>, <span class="st">"25"</span>, <span class="st">"39"</span>, <span class="st">"52"</span>)) <span class="sc">|&gt;</span>  <span class="co">#items 54 and 55 don't belong to the bsi and 11, 25, 39 and 52 are not used for calculating the GSI</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">bsi_gsi =</span> <span class="fu">mean</span>(answerscale_value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">assessment_date =</span> <span class="fu">first</span>(assessment_date),</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> <span class="fu">c</span>(case_nr,assessment_type, assessment_date)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  )  <span class="sc">|&gt;</span> </span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(case_nr, assessment_type, bsi_gsi, assessment_date)</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="co"># pivot df to have one case_nr in each row</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>bsi_wider <span class="ot">&lt;-</span> bsi_erw_gsi <span class="sc">|&gt;</span> </span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(case_nr), <span class="at">names_from =</span> assessment_type, <span class="at">values_from =</span> <span class="fu">c</span>(bsi_gsi, assessment_date)) <span class="sc">|&gt;</span> </span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">assessment_date_DI =</span> <span class="st">"assessment_date_Diagnostisches Interview ab 01.04.2017"</span>, <span class="at">bsi_gsi_DI =</span> <span class="st">"bsi_gsi_Diagnostisches Interview ab 01.04.2017"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(case_nr, bsi_gsi_DI, <span class="st">`</span><span class="at">bsi_gsi_KZT1-DU4</span><span class="st">`</span>, <span class="st">`</span><span class="at">bsi_gsi_KZT1-DUPost</span><span class="st">`</span>, <span class="st">`</span><span class="at">bsi_gsi_KZT2-DUPost</span><span class="st">`</span>, <span class="st">`</span><span class="at">bsi_gsi_LZT1-DUPost</span><span class="st">`</span>, <span class="st">`</span><span class="at">bsi_gsi_LZT2-DUPost</span><span class="st">`</span>, <span class="st">`</span><span class="at">bsi_gsi_DU-Kat6</span><span class="st">`</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div></div>
</section>
<section id="dass-42" class="level3">
<h3 class="anchored" data-anchor-id="dass-42">DASS-42</h3>
<div class="cell-container"><div class="cell-decorator"><pre>In [7]:</pre></div><div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>dass_master <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"/Volumes/meta_data/raw/raw_selfreport/DASS_ab2017.xlsx"</span>,</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">"case_nr"</span>, <span class="st">"patient_chiffre"</span>,<span class="st">"patient_sex"</span>,<span class="st">"patient_dateofbirth"</span>,<span class="st">"assessment_date"</span>,<span class="st">"assessment_type"</span>,<span class="st">"assessment_id"</span>,<span class="st">"assessment_name"</span>,<span class="st">"item_no"</span>,<span class="st">"answerscale_value"</span>,<span class="st">"therapist_no"</span>,<span class="st">"therapist_sex"</span>,<span class="st">"therapist_dateofbirth"</span>),</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">skip =</span> <span class="dv">1</span>)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co">#exclude "affected cases" with erroneous assessment_types.</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>dass_master <span class="ot">&lt;-</span> dass_master <span class="sc">%&gt;%</span> </span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>case_nr <span class="sc">%in%</span> affected_cases<span class="sc">$</span>case_nr)</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="co">#how many patients are there for each assessment type?</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>dass_master <span class="sc">|&gt;</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_patients =</span> <span class="fu">n_distinct</span>(case_nr),</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> assessment_type</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n_patients))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 32 × 2
   assessment_type n_patients
   &lt;chr&gt;                &lt;int&gt;
 1 DU-Prä                3002
 2 KZT1-DUPost           2086
 3 KZT2-DUPost           1638
 4 KZT1-DU4              1424
 5 DU-Kat6               1062
 6 DU-Kat12               852
 7 LZT1-DUPost            785
 8 DU-Kat24               676
 9 LZT-DU40               458
10 DU-Post                263
# ℹ 22 more rows</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>dass_erw <span class="ot">&lt;-</span> dass_master <span class="sc">|&gt;</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(assessment_name <span class="sc">==</span> <span class="st">"DASS-42-G"</span> <span class="sc">&amp;</span> (assessment_type <span class="sc">==</span> <span class="st">"DU-Prä"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"KZT1-DU4"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"KZT1-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"KZT2-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"LZT1-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"LZT2-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"DU-Kat6"</span>))</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>dass_erw_score <span class="ot">&lt;-</span> dass_erw <span class="sc">|&gt;</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">patient_chiffre =</span> <span class="fu">first</span>(patient_chiffre),</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">dass_total_score =</span> <span class="fu">sum</span>(answerscale_value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">dass_dep_score =</span> <span class="fu">sum</span>(</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>      answerscale_value[item_no <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">13</span>, <span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">21</span>, <span class="dv">24</span>, <span class="dv">26</span>, <span class="dv">31</span>, <span class="dv">34</span>, <span class="dv">37</span>, <span class="dv">38</span>, <span class="dv">42</span>)],</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">dass_anx_score =</span> <span class="fu">sum</span>(</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>      answerscale_value[item_no <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">9</span>, <span class="dv">15</span>, <span class="dv">19</span>, <span class="dv">20</span>, <span class="dv">23</span>, <span class="dv">25</span>, <span class="dv">28</span>, <span class="dv">30</span>, <span class="dv">36</span>, <span class="dv">40</span>, <span class="dv">41</span>)],</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">dass_str_score =</span> <span class="fu">sum</span>(</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>      answerscale_value[item_no <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">14</span>, <span class="dv">18</span>, <span class="dv">22</span>, <span class="dv">27</span>, <span class="dv">29</span>, <span class="dv">32</span>, <span class="dv">33</span>, <span class="dv">35</span>, <span class="dv">39</span>)],</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">assessment_date =</span> <span class="fu">first</span>(assessment_date),</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> <span class="fu">c</span>(case_nr, assessment_type, assessment_date)</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>    case_nr, assessment_type, dass_total_score, dass_dep_score, dass_anx_score, dass_str_score, assessment_date</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>dass_wider <span class="ot">&lt;-</span> dass_erw_score <span class="sc">|&gt;</span> </span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(case_nr), <span class="at">names_from =</span> assessment_type, <span class="at">values_from =</span> <span class="fu">c</span>(dass_total_score, dass_dep_score, dass_anx_score, dass_str_score, assessment_date)) <span class="sc">|&gt;</span> </span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(case_nr, <span class="st">`</span><span class="at">dass_total_score_DU-Prä</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_dep_score_DU-Prä</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_anx_score_DU-Prä</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_str_score_DU-Prä</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_total_score_KZT1-DU4</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_dep_score_KZT1-DU4</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_anx_score_KZT1-DU4</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_str_score_KZT1-DU4</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_total_score_KZT1-DUPost</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_dep_score_KZT1-DUPost</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_anx_score_KZT1-DUPost</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_str_score_KZT1-DUPost</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_total_score_KZT2-DUPost</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_dep_score_KZT2-DUPost</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_anx_score_KZT2-DUPost</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_str_score_KZT2-DUPost</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_total_score_LZT1-DUPost</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_dep_score_LZT1-DUPost</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_anx_score_LZT1-DUPost</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_str_score_LZT1-DUPost</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_total_score_LZT2-DUPost</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_dep_score_LZT2-DUPost</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_anx_score_LZT2-DUPost</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_str_score_LZT2-DUPost</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_total_score_DU-Kat6</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_dep_score_DU-Kat6</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_anx_score_DU-Kat6</span><span class="st">`</span>, <span class="st">`</span><span class="at">dass_str_score_DU-Kat6</span><span class="st">`</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div></div>
</section>
<section id="gas" class="level3">
<h3 class="anchored" data-anchor-id="gas">GAS</h3>
<div class="cell-container"><div class="cell-decorator"><pre>In [8]:</pre></div><div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>gas_master <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"/Volumes/meta_data/raw/raw_selfreport/GAS_ab2017.xlsx"</span>,</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">"case_nr"</span>, <span class="st">"patient_chiffre"</span>,<span class="st">"patient_sex"</span>,<span class="st">"patient_dateofbirth"</span>,<span class="st">"assessment_date"</span>,<span class="st">"assessment_type"</span>,<span class="st">"assessment_id"</span>,<span class="st">"assessment_name"</span>,<span class="st">"item_no"</span>,<span class="st">"answerscale_value"</span>,<span class="st">"therapist_no"</span>,<span class="st">"therapist_sex"</span>,<span class="st">"therapist_dateofbirth"</span>),</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">skip =</span> <span class="dv">1</span>)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="co">#exclude "affected cases" with erroneous assessment_types.</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>gas_master <span class="ot">&lt;-</span> gas_master <span class="sc">%&gt;%</span> </span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>case_nr <span class="sc">%in%</span> affected_cases<span class="sc">$</span>case_nr)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="co">#how many patients are there for each assessment type?</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>gas_master <span class="sc">|&gt;</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_patients =</span> <span class="fu">n_distinct</span>(case_nr),</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> assessment_type</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n_patients))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 31 × 2
   assessment_type n_patients
   &lt;chr&gt;                &lt;int&gt;
 1 KZT1-DUPost           1561
 2 KZT2-DUPost           1302
 3 LZT1-DUPost            658
 4 DU-Kat6                624
 5 DU-Kat12               450
 6 LZT-DU40               394
 7 DU-Kat24               321
 8 DU-Post                241
 9 DU30_Erwachsene        175
10 DU20_Erwachsene        164
# ℹ 21 more rows</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>gas_pt <span class="ot">&lt;-</span> gas_master <span class="sc">|&gt;</span> </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(assessment_name <span class="sc">==</span> <span class="st">"GAS-PT"</span> <span class="sc">&amp;</span> (assessment_type <span class="sc">==</span> <span class="st">"KZT1-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"KZT2-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"LZT1-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"LZT2-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"DU-Kat6"</span>))</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>gas_pt_mean <span class="ot">&lt;-</span> gas_pt <span class="sc">|&gt;</span> </span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">answerscale_value =</span> answerscale_value <span class="sc">-</span> <span class="dv">2</span>) <span class="sc">|&gt;</span> <span class="co">#recoding patient scaling (1-6) to be consistent with patient scaling (-1-4)</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">gas_pt_mean =</span> <span class="fu">mean</span>(answerscale_value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">assessment_date =</span> <span class="fu">first</span>(assessment_date),</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> <span class="fu">c</span>(case_nr, assessment_type, assessment_date)</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>  )  <span class="sc">|&gt;</span> </span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(case_nr, assessment_type, gas_pt_mean, assessment_date)</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>gas_th <span class="ot">&lt;-</span> gas_master <span class="sc">|&gt;</span> </span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(assessment_name <span class="sc">==</span> <span class="st">"GAS-TH"</span> <span class="sc">&amp;</span> (assessment_type <span class="sc">==</span> <span class="st">"KZT1-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"KZT2-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"LZT1-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"LZT2-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"DU-Kat6"</span>))</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>gas_th_mean <span class="ot">&lt;-</span> gas_th <span class="sc">|&gt;</span> </span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">gas_th_mean =</span> <span class="fu">mean</span>(answerscale_value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">assessment_date =</span> <span class="fu">first</span>(assessment_date),</span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> <span class="fu">c</span>(case_nr, assessment_type, assessment_date)</span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>  )  <span class="sc">|&gt;</span> </span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(case_nr, assessment_type, gas_th_mean, assessment_date)</span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a>gas_mean <span class="ot">&lt;-</span> gas_pt_mean <span class="sc">|&gt;</span> </span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(gas_th_mean, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"case_nr"</span>, <span class="st">"assessment_type"</span>, <span class="st">"assessment_date"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(case_nr, assessment_date, assessment_type, gas_pt_mean, gas_th_mean)</span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a>gas_wider <span class="ot">&lt;-</span> gas_mean <span class="sc">|&gt;</span> </span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(case_nr), <span class="at">names_from =</span> assessment_type, <span class="at">values_from =</span> <span class="fu">c</span>(gas_pt_mean, gas_th_mean, assessment_date)) <span class="sc">|&gt;</span> </span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(case_nr, <span class="st">"gas_pt_mean_KZT1-DUPost"</span>, <span class="st">"gas_pt_mean_KZT2-DUPost"</span>, <span class="st">"gas_pt_mean_LZT1-DUPost"</span>, <span class="st">"gas_pt_mean_LZT2-DUPost"</span>, <span class="st">"gas_pt_mean_DU-Kat6"</span>, <span class="st">"gas_th_mean_KZT1-DUPost"</span>, <span class="st">"gas_th_mean_KZT2-DUPost"</span>, <span class="st">"gas_th_mean_LZT1-DUPost"</span>, <span class="st">"gas_th_mean_LZT2-DUPost"</span>, <span class="st">"gas_th_mean_DU-Kat6"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div></div>
</section>
<section id="pmh" class="level3">
<h3 class="anchored" data-anchor-id="pmh">PMH</h3>
<div class="cell-container"><div class="cell-decorator"><pre>In [9]:</pre></div><div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>pmh_master <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"/Volumes/meta_data/raw/raw_selfreport/Seelische_Gesundheit_ab2017.xlsx"</span>,</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">"case_nr"</span>, <span class="st">"patient_chiffre"</span>,<span class="st">"patient_sex"</span>,<span class="st">"patient_dateofbirth"</span>,<span class="st">"assessment_date"</span>,<span class="st">"assessment_type"</span>,<span class="st">"assessment_id"</span>,<span class="st">"assessment_name"</span>,<span class="st">"item_no"</span>,<span class="st">"answerscale_value"</span>,<span class="st">"therapist_no"</span>,<span class="st">"therapist_sex"</span>,<span class="st">"therapist_dateofbirth"</span>),</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">skip =</span> <span class="dv">1</span>)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="co">#exclude "affected cases" with erroneous assessment_types.</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>pmh_master <span class="ot">&lt;-</span> pmh_master <span class="sc">%&gt;%</span> </span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>case_nr <span class="sc">%in%</span> affected_cases<span class="sc">$</span>case_nr)</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="co">#how many patients are there for each assessment type?</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>pmh_master <span class="sc">|&gt;</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_patients =</span> <span class="fu">n_distinct</span>(case_nr),</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> assessment_type</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n_patients))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 33 × 2
   assessment_type n_patients
   &lt;chr&gt;                &lt;int&gt;
 1 DU-Prä                3006
 2 KZT1-DUPost           2109
 3 KZT2-DUPost           1650
 4 KZT1-DU4              1425
 5 DU-Kat6               1056
 6 DU-Kat12               850
 7 LZT1-DUPost            784
 8 DU-Kat24               665
 9 LZT-DU40               459
10 DU-Post                258
# ℹ 23 more rows</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>pmh_erw <span class="ot">&lt;-</span> pmh_master <span class="sc">|&gt;</span> </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(assessment_type <span class="sc">==</span> <span class="st">"DU-Prä"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"KZT1-DU4"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"KZT1-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"KZT2-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"LZT1-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"LZT2-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"DU-Kat6"</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="co"># PMH-Summenscore berechnen (Summe der Itemwerte je Fall und Assessment-Typ)</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>pmh_erw_sum <span class="ot">&lt;-</span> pmh_erw <span class="sc">|&gt;</span> </span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">assessment_date =</span> <span class="fu">first</span>(assessment_date),</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">pmh_sum =</span> <span class="fu">sum</span>(answerscale_value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> <span class="fu">c</span>(case_nr, assessment_type, assessment_date)</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="co"># pivot df to have one case_nr in each row</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>pmh_wider <span class="ot">&lt;-</span> pmh_erw_sum <span class="sc">|&gt;</span> </span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(case_nr), <span class="at">names_from =</span> assessment_type, <span class="at">values_from =</span> <span class="fu">c</span>(pmh_sum, assessment_date)) <span class="sc">|&gt;</span> </span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(case_nr, <span class="st">"pmh_sum_DU-Prä"</span>, <span class="st">"pmh_sum_KZT1-DU4"</span>, <span class="st">"pmh_sum_KZT1-DUPost"</span>, <span class="st">"pmh_sum_KZT2-DUPost"</span>, <span class="st">"pmh_sum_LZT1-DUPost"</span>, <span class="st">"pmh_sum_LZT2-DUPost"</span>, <span class="st">"pmh_sum_DU-Kat6"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div></div>
</section>
<section id="global-improvement" class="level3">
<h3 class="anchored" data-anchor-id="global-improvement">Global Improvement</h3>
<div class="cell-container"><div class="cell-decorator"><pre>In [10]:</pre></div><div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>glob_master <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"/Volumes/meta_data/raw/raw_selfreport/Globbeurteilung_SuccessRating_ab2017.xlsx"</span>,</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">"case_nr"</span>, <span class="st">"patient_chiffre"</span>,<span class="st">"patient_sex"</span>,<span class="st">"patient_dateofbirth"</span>,<span class="st">"assessment_date"</span>,<span class="st">"assessment_type"</span>,<span class="st">"assessment_id"</span>,<span class="st">"assessment_name"</span>,<span class="st">"item_no"</span>,<span class="st">"answerscale_value"</span>,<span class="st">"therapist_no"</span>,<span class="st">"therapist_sex"</span>,<span class="st">"therapist_dateofbirth"</span>),</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">skip =</span> <span class="dv">1</span>)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="co">#exclude "affected cases" with erroneous assessment_types.</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>glob_master <span class="ot">&lt;-</span> glob_master <span class="sc">%&gt;%</span> </span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>case_nr <span class="sc">%in%</span> affected_cases<span class="sc">$</span>case_nr)</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="co">#how many patients are there for each assessment type? Therapist version is not assessed at FU measurements.</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>glob_master <span class="sc">|&gt;</span> </span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_patients =</span> <span class="fu">n_distinct</span>(case_nr),</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> assessment_type</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n_patients))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 28 × 2
   assessment_type n_patients
   &lt;chr&gt;                &lt;int&gt;
 1 KZT1-DUPost           2133
 2 KZT2-DUPost           1661
 3 DU-Kat6               1064
 4 DU-Kat12               851
 5 LZT1-DUPost            794
 6 DU-Kat24               676
 7 LZT-DU40               462
 8 DU-Post                264
 9 LZT2-DUPost            199
10 DU30_Erwachsene        184
# ℹ 18 more rows</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(glob_master<span class="sc">$</span>assessment_name)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Glob-Pt Globalbeurteilung"       "Glob-Th Globalbeurteilung"      
[3] "Global Success Rating - Patient"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co">#remove non-relevant assessment types (e.g.from children and adolesent database, group sessions, assessment types with very little cases) and assessment names (e.g. kodap pre)</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>glob_pt <span class="ot">&lt;-</span> glob_master <span class="sc">|&gt;</span> </span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(assessment_name <span class="sc">==</span> <span class="st">"Glob-Pt Globalbeurteilung"</span> <span class="sc">&amp;</span> (assessment_type <span class="sc">==</span> <span class="st">"KZT1-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"KZT2-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"LZT1-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"LZT2-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"DU-Kat6"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"DU-Kat12"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"DU-Kat24"</span>))</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>glob_pt_wider <span class="ot">&lt;-</span> glob_pt <span class="sc">|&gt;</span> </span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> case_nr, <span class="at">names_from =</span> <span class="fu">c</span>(item_no, assessment_type), <span class="at">values_from =</span> answerscale_value) <span class="sc">|&gt;</span> </span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"glob_pt_satisfaction_KZT1-DUPost"</span> <span class="ot">=</span> <span class="st">"1_KZT1-DUPost"</span>, <span class="st">"glob_pt_satisfaction_KZT2-DUPost"</span> <span class="ot">=</span> <span class="st">"1_KZT2-DUPost"</span>, <span class="st">"glob_pt_satisfaction_LZT1-DUPost"</span> <span class="ot">=</span> <span class="st">"1_LZT1-DUPost"</span>, <span class="st">"glob_pt_satisfaction_LZT2-DUPost"</span> <span class="ot">=</span> <span class="st">"1_LZT2-DUPost"</span>, <span class="st">"glob_pt_satisfaction_DU-Kat6"</span> <span class="ot">=</span> <span class="st">"1_DU-Kat6"</span>, <span class="st">"glob_pt_satisfaction_DU-Kat12"</span> <span class="ot">=</span> <span class="st">"1_DU-Kat12"</span>, <span class="st">"glob_pt_satisfaction_DU-Kat24"</span> <span class="ot">=</span> <span class="st">"1_DU-Kat24"</span>, <span class="st">"glob_pt_benefit_KZT1-DUPost"</span> <span class="ot">=</span> <span class="st">"2_KZT1-DUPost"</span>, <span class="st">"glob_pt_benefit_KZT2-DUPost"</span> <span class="ot">=</span> <span class="st">"2_KZT2-DUPost"</span>, <span class="st">"glob_pt_benefit_LZT1-DUPost"</span> <span class="ot">=</span> <span class="st">"2_LZT1-DUPost"</span>, <span class="st">"glob_pt_benefit_LZT2-DUPost"</span> <span class="ot">=</span> <span class="st">"2_LZT2-DUPost"</span>, <span class="st">"glob_pt_benefit_DU-Kat6"</span> <span class="ot">=</span> <span class="st">"2_DU-Kat6"</span>, <span class="st">"glob_pt_benefit_DU-Kat12"</span> <span class="ot">=</span> <span class="st">"2_DU-Kat12"</span>, <span class="st">"glob_pt_benefit_DU-Kat24"</span> <span class="ot">=</span> <span class="st">"2_DU-Kat24"</span>)</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="co">#remove non-relevant assessment types (e.g.from children and adolesent database, group sessions, assessment types with very little cases) and assessment names (e.g. kodap pre)</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>glob_th <span class="ot">&lt;-</span> glob_master <span class="sc">|&gt;</span> </span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(assessment_name <span class="sc">==</span> <span class="st">"Glob-Th Globalbeurteilung"</span> <span class="sc">&amp;</span> (assessment_type <span class="sc">==</span> <span class="st">"KZT1-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"KZT2-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"LZT1-DUPost"</span> <span class="sc">|</span> assessment_type <span class="sc">==</span> <span class="st">"LZT2-DUPost"</span>))</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>glob_th_wider <span class="ot">&lt;-</span> glob_th <span class="sc">|&gt;</span> </span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> case_nr, <span class="at">names_from =</span> <span class="fu">c</span>(item_no, assessment_type), <span class="at">values_from =</span> answerscale_value) <span class="sc">|&gt;</span> </span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"glob_th_satisfaction_KZT1-DUPost"</span> <span class="ot">=</span> <span class="st">"1_KZT1-DUPost"</span>, <span class="st">"glob_th_satisfaction_KZT2-DUPost"</span> <span class="ot">=</span> <span class="st">"1_KZT2-DUPost"</span>, <span class="st">"glob_th_satisfaction_LZT1-DUPost"</span> <span class="ot">=</span> <span class="st">"1_LZT1-DUPost"</span>, <span class="st">"glob_th_satisfaction_LZT2-DUPost"</span> <span class="ot">=</span> <span class="st">"1_LZT2-DUPost"</span>, <span class="st">"glob_th_benefit_KZT1-DUPost"</span> <span class="ot">=</span> <span class="st">"2_KZT1-DUPost"</span>, <span class="st">"glob_th_benefit_KZT2-DUPost"</span> <span class="ot">=</span> <span class="st">"2_KZT2-DUPost"</span>, <span class="st">"glob_th_benefit_LZT1-DUPost"</span> <span class="ot">=</span> <span class="st">"2_LZT1-DUPost"</span>, <span class="st">"glob_th_benefit_LZT2-DUPost"</span> <span class="ot">=</span> <span class="st">"2_LZT2-DUPost"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div></div>
</section>
</section>
<section id="prepare-text-data" class="level2">
<h2 class="anchored" data-anchor-id="prepare-text-data">prepare text data</h2>
<div class="cell-container"><div class="cell-decorator"><pre>In [11]:</pre></div><div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>transcription_hattingen_2017_2018_2019_corrected <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"/Volumes/meta_data/processed/processed_transcriptions/corrected/transcription_hattingen_2017_2018_2019_corrected.csv"</span>,</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">delim =</span> <span class="st">","</span>,</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">"path_audiofile"</span>,<span class="st">"patient_chiffre"</span>,<span class="st">"txt1_problem_development"</span>,<span class="st">"txt2_extra_stressors"</span>,<span class="st">"txt3_pre_onset_changes"</span>,<span class="st">"txt4_event_connection"</span>,<span class="st">"txt5_physical_symptoms"</span>,<span class="st">"txt6_problem_causes"</span>,<span class="st">"txt7_expected_improvements"</span>,<span class="st">"txt8_environment_response"</span>,<span class="st">"txt9_no_change_requested"</span>, <span class="st">"txt10_problem_description"</span>,<span class="st">"txt11_impacted_life_areas"</span>,<span class="st">"txt12_therapy_goals"</span>),</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">skip =</span> <span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 336 Columns: 14
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (14): path_audiofile, patient_chiffre, txt1_problem_development, txt2_ex...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>transcription_hattingen_2020_2021_corrected <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"/Volumes/meta_data/processed/processed_transcriptions/corrected/transcription_hattingen_2020_2021_corrected.csv"</span>,</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">delim =</span> <span class="st">";"</span>,</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">"path_audiofile"</span>,<span class="st">"patient_chiffre"</span>,<span class="st">"txt1_problem_development"</span>,<span class="st">"txt2_extra_stressors"</span>,<span class="st">"txt3_pre_onset_changes"</span>,<span class="st">"txt4_event_connection"</span>,<span class="st">"txt5_physical_symptoms"</span>,<span class="st">"txt6_problem_causes"</span>,<span class="st">"txt7_expected_improvements"</span>,<span class="st">"txt8_environment_response"</span>,<span class="st">"txt9_no_change_requested"</span>, <span class="st">"txt10_problem_description"</span>,<span class="st">"txt11_impacted_life_areas"</span>,<span class="st">"txt12_therapy_goals"</span>),</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">skip =</span> <span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 155 Columns: 14
── Column specification ────────────────────────────────────────────────────────
Delimiter: ";"
chr (14): path_audiofile, patient_chiffre, txt1_problem_development, txt2_ex...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>transcription_hattingen_2022_corrected <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"/Volumes/meta_data/processed/processed_transcriptions/corrected/transcription_hattingen_2022_corrected.csv"</span>,</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">delim =</span> <span class="st">";"</span>,</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">"path_audiofile"</span>,<span class="st">"patient_chiffre"</span>,<span class="st">"txt1_problem_development"</span>,<span class="st">"txt2_extra_stressors"</span>,<span class="st">"txt3_pre_onset_changes"</span>,<span class="st">"txt4_event_connection"</span>,<span class="st">"txt5_physical_symptoms"</span>,<span class="st">"txt6_problem_causes"</span>,<span class="st">"txt7_expected_improvements"</span>,<span class="st">"txt8_environment_response"</span>,<span class="st">"txt9_no_change_requested"</span>, <span class="st">"txt10_problem_description"</span>,<span class="st">"txt11_impacted_life_areas"</span>,<span class="st">"txt12_therapy_goals"</span>),</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">skip =</span> <span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 88 Columns: 14
── Column specification ────────────────────────────────────────────────────────
Delimiter: ";"
chr (14): path_audiofile, patient_chiffre, txt1_problem_development, txt2_ex...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>transcription_hattingen_2023_corrected <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"/Volumes/meta_data/processed/processed_transcriptions/corrected/transcription_hattingen_2023_corrected.csv"</span>,</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">delim =</span> <span class="st">","</span>,</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">"path_audiofile"</span>,<span class="st">"patient_chiffre"</span>,<span class="st">"txt1_problem_development"</span>,<span class="st">"txt2_extra_stressors"</span>,<span class="st">"txt3_pre_onset_changes"</span>,<span class="st">"txt4_event_connection"</span>,<span class="st">"txt5_physical_symptoms"</span>,<span class="st">"txt6_problem_causes"</span>,<span class="st">"txt7_expected_improvements"</span>,<span class="st">"txt8_environment_response"</span>,<span class="st">"txt9_no_change_requested"</span>, <span class="st">"txt10_problem_description"</span>,<span class="st">"txt11_impacted_life_areas"</span>,<span class="st">"txt12_therapy_goals"</span>),</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">skip =</span> <span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 98 Columns: 14
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (14): path_audiofile, patient_chiffre, txt1_problem_development, txt2_ex...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>transcription_bochum_alt_corrected <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"/Volumes/meta_data/processed/processed_transcriptions/corrected/transcription_bochum_alt_corrected.csv"</span>,</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">delim =</span> <span class="st">","</span>,</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">"path_audiofile"</span>,<span class="st">"patient_chiffre"</span>,<span class="st">"txt1_problem_development"</span>,<span class="st">"txt2_extra_stressors"</span>,<span class="st">"txt3_pre_onset_changes"</span>,<span class="st">"txt4_event_connection"</span>,<span class="st">"txt5_physical_symptoms"</span>,<span class="st">"txt6_problem_causes"</span>,<span class="st">"txt7_expected_improvements"</span>,<span class="st">"txt8_environment_response"</span>,<span class="st">"txt9_no_change_requested"</span>, <span class="st">"txt10_problem_description"</span>,<span class="st">"txt11_impacted_life_areas"</span>,<span class="st">"txt12_therapy_goals"</span>),</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">skip =</span> <span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 220 Columns: 14
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (14): path_audiofile, patient_chiffre, txt1_problem_development, txt2_ex...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>merged_text_raw <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(transcription_hattingen_2017_2018_2019_corrected, transcription_hattingen_2020_2021_corrected, transcription_hattingen_2022_corrected, transcription_hattingen_2023_corrected, transcription_bochum_alt_corrected)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>merged_text <span class="ot">&lt;-</span> merged_text_raw <span class="sc">|&gt;</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="co"># extract treatment_center, year of the treatment end from audiofile path</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">treatment_center       =</span> <span class="fu">str_match</span>(path_audiofile, <span class="st">"raw_audio/([^/]+)/"</span>)[, <span class="dv">2</span>],</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">treatment_end_year_text =</span> <span class="fu">str_match</span>(path_audiofile, <span class="st">"raw_audio/[^/]+/(</span><span class="sc">\\</span><span class="st">d{4})"</span>)[, <span class="dv">2</span>],</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">folder                 =</span> <span class="fu">dirname</span>(path_audiofile),</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">zoom_nr                =</span> <span class="fu">str_extract</span>(path_audiofile, <span class="st">"(?&lt;=ZOOM)</span><span class="sc">\\</span><span class="st">d+"</span>),</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">zoom_nr                =</span> <span class="fu">as.integer</span>(zoom_nr)</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(patient_chiffre, folder) <span class="sc">|&gt;</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(zoom_nr, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> <span class="co"># remove the older zoom_nr for each group of patient and folder</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>    patient_chiffre,</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>    treatment_center,</span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>    treatment_end_year_text,</span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>    txt1_problem_development,</span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>    txt2_extra_stressors,</span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>    txt3_pre_onset_changes,</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>    txt4_event_connection,</span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>    txt5_physical_symptoms,</span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>    txt6_problem_causes,</span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>    txt7_expected_improvements,</span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>    txt8_environment_response,</span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>    txt9_no_change_requested,</span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a>    txt10_problem_description,</span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>    txt11_impacted_life_areas,</span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a>    txt12_therapy_goals</span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a>merged_text_clean <span class="ot">&lt;-</span> merged_text <span class="sc">|&gt;</span></span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(</span>
<span id="cb64-34"><a href="#cb64-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.na</span>(patient_chiffre) <span class="sc">|</span></span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">if_all</span>(<span class="fu">contains</span>(<span class="st">"txt"</span>), is.na)</span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true" tabindex="-1"></a>  ))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div></div>
</section>
<section id="merge-text-and-self-rating-scales" class="level2">
<h2 class="anchored" data-anchor-id="merge-text-and-self-rating-scales">merge text and self-rating scales</h2>
<div class="cell-container"><div class="cell-decorator"><pre>In [12]:</pre></div><div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>df_merged_self_rating <span class="ot">&lt;-</span> dsmv_filtered_wider_labeled <span class="sc">|&gt;</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(patient_kodap_pre_demographics_wider, <span class="at">by =</span> <span class="st">"case_nr"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(therapist_kodap_pre_context_wider, <span class="at">by =</span> <span class="st">"case_nr"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(bdi_wider_complete, <span class="at">by =</span> <span class="st">"case_nr"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(bsi_wider, <span class="at">by =</span> <span class="st">"case_nr"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(dass_wider, <span class="at">by =</span> <span class="st">"case_nr"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(pmh_wider, <span class="at">by =</span> <span class="st">"case_nr"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(gas_wider, <span class="at">by =</span> <span class="st">"case_nr"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(glob_th_wider, <span class="at">by =</span> <span class="st">"case_nr"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(glob_pt_wider, <span class="at">by =</span> <span class="st">"case_nr"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(patient_cgi_improvement_wider, <span class="at">by =</span> <span class="st">"case_nr"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(therapist_cgi_improvement_wider, <span class="at">by =</span> <span class="st">"case_nr"</span>) </span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>df_merged <span class="ot">&lt;-</span> merged_text_clean <span class="sc">|&gt;</span></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(df_merged_self_rating, <span class="at">by =</span> <span class="st">"patient_chiffre"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(case_nr, patient_dateofbirth, patient_age_therapy_start, patient_sex, marital_status, in_relationship, general_education, vocational_qualification, work_ability_status, previous_psychotherapy, assessment_date_DI, icd10_code, CGI_severity, therapist_dateofbirth, therapist_age_therapy_start, therapist_sex, <span class="fu">everything</span>(), <span class="sc">-</span>patient_chiffre, <span class="sc">-</span>icd10_code) <span class="co">#remove chiffre and icd code for export</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in left_join(merged_text_clean, df_merged_self_rating, by = "patient_chiffre"): Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 2 of `x` matches multiple rows in `y`.
ℹ Row 519 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(df_merged, <span class="st">"/Volumes/meta_data/processed/working_data/merged_data.rds"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div></div>
</section>
<section id="plausibility-checks-of-assessment-time-points" class="level2">
<h2 class="anchored" data-anchor-id="plausibility-checks-of-assessment-time-points">Plausibility Checks of Assessment Time Points</h2>
<p>During the calculation of sum scores, it became apparent that in some cases identical assessment time points (e.g., LZT 2) were documented more than once. This results in implausible sum scores (e.g., values &gt; 27 for the PMH). This issue is not limited to the PMH, but occurs across multiple instruments (e.g., BDI, BSI, DASS, GAS), suggesting a dataset-wide problem rather than an instrument-specific one. The purpose of the following plausibility check is to identify cases in which multiple different assessment dates (assessment_date) exist within the same combination of case number (case_nr) and assessment type (assessment_type).</p>
<div class="cell-container"><div class="cell-decorator"><pre>In [13]:</pre></div><div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identification of cases with inconsistent assessment time points</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="co"># (multiple assessment_dates within the same case_nr × assessment_type)</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Collect instrument-specific datasets</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>instrument_dfs <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">pmh =</span> pmh_erw,</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">bdi =</span> bdi_erw,</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">bsi =</span> bsi_erw,</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">dass =</span> dass_erw,</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">gas_th =</span> gas_th,</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">gas_pt =</span> gas_pt,</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">cgi_i_pt =</span> patient_kodap_post,</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">cgi_i_th =</span> therapist_kodap_post)</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Extract inconsistent cases per instrument</span></span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>inconsistent_cases <span class="ot">&lt;-</span> <span class="fu">imap_dfr</span>(instrument_dfs, <span class="sc">~</span> .x <span class="sc">|&gt;</span></span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(case_nr, assessment_type) <span class="sc">|&gt;</span></span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n_distinct</span>(assessment_date, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(case_nr, patient_chiffre, assessment_type, assessment_date) <span class="sc">|&gt;</span></span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">instrument =</span> .y)</span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(case_nr, instrument, assessment_type, assessment_date)</span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Unique list of affected patients</span></span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a>affected_cases <span class="ot">&lt;-</span> inconsistent_cases <span class="sc">|&gt;</span></span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(case_nr) <span class="sc">|&gt;</span></span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(case_nr)</span>
<span id="cb68-29"><a href="#cb68-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-30"><a href="#cb68-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Output</span></span>
<span id="cb68-31"><a href="#cb68-31" aria-hidden="true" tabindex="-1"></a>inconsistent_cases</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 5
# ℹ 5 variables: case_nr &lt;dbl&gt;, patient_chiffre &lt;chr&gt;, assessment_type &lt;chr&gt;,
#   assessment_date &lt;dttm&gt;, instrument &lt;chr&gt;</code></pre>
</div>
</div></div>
<p><strong>Results of the Plausibility Check</strong></p>
<p>At present, 12 patients (chiffres) are affected by this issue.</p>
<div class="cell-container"><div class="cell-decorator"><pre>In [14]:</pre></div><div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>affected_cases</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 1
# ℹ 1 variable: case_nr &lt;dbl&gt;</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co">#saveRDS(affected_cases, "/Volumes/meta_data/processed/working_data/affected_cases.rds")</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div></div>
<p><em>Possible Explanations</em></p>
<ul>
<li><p>An identical assessment time point was entered more than once.</p></li>
<li><p>An incorrect assessment type was assigned because another measurement is missing and an existing one was duplicated instead.</p></li>
<li><p>After a follow-up assessment (e.g., Kat6), a time point from an ongoing therapy (e.g., LZT 2) appears again, followed by another follow-up assessment. This may indicate that a therapy was terminated and later resumed, while continuing under the same case number.</p></li>
<li><p>A pre-treatment assessment (Du-Prä) was conducted without subsequent therapy; several years later, the same patient re-entered treatment and was registered under the same case number, including a new pre-treatment assessment and follow-up measurements.</p></li>
</ul>
<p><em>Further Procedure</em></p>
<p>Determine which of the affected patient chiffres are included in the final dataset containing text data. For these cases, conduct a manual review of the original records to decide which assessment should be considered the “correct” one for analysis (likely requiring case-by-case decisions based on chronological order and documentation).</p>
<div class="cell-container"><div class="cell-decorator"><pre>In [15]:</pre></div><div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> df_merged <span class="sc">%&gt;%</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(affected_cases, <span class="at">by =</span> <span class="st">"case_nr"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div></div>
</section>
</section>
     </main>
<!-- /main column -->  <script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>  </div> <!-- /content --> 
  
</body></html>